---
layout: post
title: "GCP (Google Compute Platform/Google Certified Professional)"
excerpt: "The cloud that runs on fast Google Fiber"
shorturl: "https://goo.gl/PDqRRL"
modified:
tags: [google, cloud]
image:
# feature: pic blue black stars spin 1900x500.jpg
  feature: https://cloud.githubusercontent.com/assets/300046/14621973/fe6e21a6-0583-11e6-9a94-a969a51759b6.jpg
  credit: Jeremy Thomas
  creditlink: https://www.flickr.com/photos/132218932@N03/page2
comments: true
---
<i>{{ page.excerpt }}</i>
<hr />

{% include _toc.html %}

Here is a <strong>hands-on</strong> introduction to learn the Google Compute Platform (GCP) and getting certified as a Google Certified Professional (GCP).

Concepts are introduced succintly after you take a small action, followed by succinct commentary, with links to more information.

## Free Cloud Time with Training

<a target="_blank" href="https://google-run.qwiklabs.com/focuses/7010">
Google's Qwiklabs</a> includes cloud instance time (around an hour each class). At the end you get a certificate of completion for your resume.

Quests:

* https://google.qwiklabs.com/quests/23<br />G = GCP Essentials Quest
* https://google.qwiklabs.com/quests/29<br />K = Kubernetes in the Google Cloud
* https://google.qwiklabs.com/quests/27<br />W = Windows on GCP
<br /><br />

<table border="1" style="width:100%" cellpadding="4" cellspacing="0">
<tr><th>Quest</th><th>Module</th><th>Level</th><th>Credits</th><th>Time</th></tr>
<tr align="top"><td> G </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/5318">Creating a Virtual Machine</a>
</td><td>Introductory</td><td>1 </td><td>30m
</td></tr>
<tr align="top"><td> G </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/5319">Getting Started with Cloud Shell & gcloud</a>
</td><td>Introductory</td><td>1 </td><td>40m
</td></tr>
<tr align="top"><td> G </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/5322">Provision Services with Cloud Launcher</a>
</td><td>Introductory</td><td>1 </td><td>30m
</td></tr>
<tr align="top"><td> G </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/6988">Creating a Persistent Disk (Activity Tracking)</a>
</td><td>Introductory</td><td>1 </td><td>30m
</td></tr>
<tr align="top"><td> G </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/5317">Creating a Persistent Disk</a>
</td><td>Introductory</td><td>1 </td><td>30m
</td></tr>
<tr align="top"><td> G </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/5321">Monitoring Cloud Infrastructure with Stackdriver</a>
</td><td>Fundamental</td><td>1 </td><td>45m
</td></tr>
<tr align="top"><td> G </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/5323">Set Up Network and HTTP Load Balancers</a>
</td><td>Advanced</td><td>1 </td><td>40m
</td></tr>
<tr align="top"><td> K </td><td>Introduction to Docker
</td><td>Beginner</td><td>1</td><td>41m
</td></tr>
<tr align="top"><td> G&K </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/7011">Hello Node Kubernetes</a>
</td><td>Advanced</td><td>7</td><td>60m
</td></tr>
<tr align="top"><td> K </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/7012">Orchestrating the Cloud with Kubernetes</a>
</td><td>Expert</td><td>9</td><td>75m
</td></tr>
<tr align="top"><td> K </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/7013">Managing Deployments Using Kubernetes Engine</a>
</td><td>Advanced</td><td>7</td><td>60m
</td></tr>
<tr align="top"><td> K </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/7014">Continuous Delivery with Jenkins in Kubernetes Engine</a>
</td><td>Expert</td><td>7</td><td>80m
</td></tr>
<tr align="top"><td> K </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/7015">Running a MongoDB Database in Kubernetes with StatefulSets</a>
</td><td>Expert</td><td>9 </td><td>50m
</td></tr>
<tr align="top"><td> G&K </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/6023">Build a Slack Bot with Node.js on Kubernetes</a>
</td><td>Advanced</td><td>7</td><td>60m
</td></tr>
<tr align="top"><td> G&K </td><td><a target="_blank" href="https://google.qwiklabs.com/focuses/7017">Helm Package Manager</a>
</td><td>Advanced</td><td>7</td><td>50m
</td></tr>
</table>

These labs make use of commands rather than interactive UI.

PROTIP: Use different browser programs to switch quickly among them:

1. In a Brave browser, Qwiklabs instructions (especially if you're using a different Google account for Quicklab than for gmail)
2. In Chrome, open as an Incognito window to click START of a Cloud console.
3. In Firefox, open this blog page.

   PROTIP: The time starts after you click "Start Lab". 
   So read through the instructions before starting.


## Free $300 account for 60 days

<a target="_blank" href="https://cloud.google.com/free">https://cloud.google.com/free</a> 

In US regions, new accounts get $300 of overage for 12 months.

   PROTIP: Create several emails, each with a different credit card.

   Throughout, <a target="_blank" href="https://cloud.google.com/free/docs/always-free-usage-limits">
   Google does not charge for a low level of usage</a>:

   * No more that 8 cores at once across all instances
   * No more than 100 GB of solid state disk (SSD) space
   * Max. 2TB (2,000 GB) total persistent standard disk space
   <br /><br />

   Google bills in minute-level increments (with a 10-minute minimum charge),
   unlike Amazon which charges by the hour.

1. In Chrome or Firefox browser, get a Gmail address.
2. Go to the free trial page:

   <a target="_blank" href="https://console.developers.google.com/freetrial">
   https://console.developers.google.com/freetrial</a>

   Alternately, go to Google Cloud's marketing home page at:

   <a target="_blank" href="https://cloud.google.com/">
   https://cloud.google.com</a>

0. Click the Try It Free button. Complete the registration. Click Agree and continue. Start my new trial.

0. Configure at <a target="_blank" href="https://console.cloud.google.com/">
   console.cloud.google.com</a>

0. PROTIP: Bookmark this URL.

   PROTIP: Google remembers your last project and its region, and gives them to you even if you do not specify them in the URL.

   CAUTION: Your bill can suddenly jump up to thousands of dollars a day, with no explanation.
   Configure to put limits.

## Social

* <a target="_blank" href="https://twitter.com/googlecloud">
   https://twitter.com/googlecloud</a> = @googlecloud
* <a target="_blank" href="https://plus.google.com/+googlecloudplatform">
   https://plus.google.com/+googlecloudplatform</a> = +googlecloudplatform
* <a target="_blank" href="https://googlecloudplatform.blogspot.com">
   https://googlecloudplatform.blogspot.com</a>
* <a target="_blank" href="https://cloud.google.com/newslewtters">
   https://cloud.google.com/newslewtters</a> monthly emails.
* LinkedIn group?
* Google NEXT conference online.
* GOTO conference online.


## Google Certified Professional (GCP) Certification Exams

As of December, 2016, Google pared down to three certifications.
See https://cloud.google.com/certification/<br />
Each 2 hour $200 exam is taken in-person at a
<a target="_blank" href="https://www.kryteriononline.com/Locate-Test-Center">
kryterion Test Center</a>. 

1. Google Certified Professional - <a href="#CloudArchitect">Cloud Architect</a>
2. Google Certified Professional - <a href="#DataEngineer">Data Engineer</a> (for big data)
3. Google Certified Associate - G Suite Administrator (Gmail, Google Drive, etc.)

NOTE: There is no "Associate" level, unlike Amazon.

See https://cloud.google.com/training

<a name="CloudArchitect"></a>

### Cloud Architect

<a target="_blank" href="https://cloud.google.com/certification/guides/cloud-architect/">Cloud Architect</a>
   -- design, build and manage solutions on Google Cloud Platform.

Case studies:

*  <a href="https://cloud.google.com/certification/guides/cloud-architect/casestudy-jencomart">
JencoMart</a> retailer migrating LAMP stacks to cloud (LAMP = Linux OS, Apache HTTP server, MySQL database, PHP)

* <a href="https://cloud.google.com/certification/guides/cloud-architect/casestudy-mountkirkgames">
Mountkirk online multiplayer Games</a> MySQL on Google Compute Engine for scaling

* <a href="https://cloud.google.com/certification/guides/cloud-architect/casestudy-dress4win">
Dress4Win</a> website dev/test

* <a href="https://cloud.google.com/certification/guides/cloud-architect/casestudy-terramearth">
TerramEarth</a> mining vehicles field data collection from cellular network to reduce downtime

<a target="_blank" href="https://www.coursera.org/specializations/gcp-architecture">
   https://www.coursera.org/specializations/gcp-architecture</a>
   Architecting with Google Cloud Platform Specialization
   6 courses (that start once per month) for $79 USD per month via qwiklabs:

   1. <a target="_blank" href="https://www.coursera.org/learn/gcp-fundamentals">
   Google Cloud Platform Fundamentals: Core Infrastructure</a>
   2. <a target="_blank" href="https://www.coursera.org/learn/gcp-infrastructure-foundation">
   Essential Cloud Infrastructure: Foundation</a>
   3. <a target="_blank" href="https://www.coursera.org/learn/gcp-infrastructure-core-services">Essential Cloud Infrastructure: Core Services</a>
   4. <a target="_blank" href="https://www.coursera.org/learn/gcp-infrastructure-scaling-automation">Elastic Cloud Infrastructure: Scaling and Automation</a>
   5. <a target="_blank" href="https://www.coursera.org/learn/gcp-infrastructure-containers-services">Elastic Cloud Infrastructure: Containers and Services</a>
   6. <a target="_blank" href="https://www.coursera.org/learn/cloud-infrastructure-design-process">Reliable Cloud Infrastructure: Design and Process</a>

More about this certification:

* <a target="_blank" href="https://www.youtube.com/playlist?list=PLIivdWyY5sqI8RuUibiH8sMb1ExIw0lAR">
Google Cloud Next â€™17 Conference 217 Videos on YouTube</a>

* <a target="_blank" href="https://medium.com/@earlg3/google-cloud-architect-exam-study-materials-5ab327b62bc8">
   https://medium.com/@earlg3/google-cloud-architect-exam-study-materials-5ab327b62bc8</a>



<a name="DataEngineer"></a>

### Data Engineer 

<a target="_blank" href="https://cloud.google.com/certification/guides/data-engineer/">
Data Engineer certification Guide</a>

<a target="_blank" href="https://cloud.google.com/training/courses/data-engineering">
https://cloud.google.com/training/courses/data-engineering</a>
is used within the
<a target="_blank" href="https://www.coursera.org/specializations/gcp-data-machine-learning">
Data Engineering on Google Cloud Platform Specialization on Coursera</a>.
It is a series of five one-week classes ($49 per month after 7 days).
These have videos that syncs with transcript text, but no hints to quiz answers or live help.

1. Building Resilient Streaming Systems on Google Cloud Platform $99 USD

2. Leveraging Unstructured Data with Cloud Dataproc on Google Cloud Platform $59 USD

3. Google Cloud Platform Big Data and Machine Learning Fundamentals $59 USD

4. Serverless Data Analysis with Google BigQuery and Cloud Dataflow $99 USD

5. <a target="_blank" href="https://www.coursera.org/learn/serverless-machine-learning-gcp">Serverless Machine Learning with Tensorflow on Google Cloud Platform</a> $99 USD 
by <a target="_blank" href="https://aisoftwarellc.weebly.com/">Valliappa Lakshmanan</a> uses Tensorflow Cloud ML service to learn a map of New York City by analyzing taxi cab locations. 

   * Vision image sentiment
   * <a target="_blank" href="https://cloud.google.com/speech">Speech</a> recognizes 110 languages, dictating, 
   * Translate
   * personalization


## Why Google Cloud?

As with other clouds:

* "Pay as you go" rather than significant up-front purchase, which eats time
* No software to install (and go stale)
* Google scale - 9 cloud regions in 27 zones. 90 Edge cache

But most of all, Google has a fast fibre network, enabling high performance across the world.



## New Project

   <strong>Service accounts</strong> are automatically created for each project:

   <em>project_number</em>@developer.gserviceaccount.com<br />
   <em>project_id</em>@developer.gserviceaccount.com

Project ID is unique among all other projects at Google and cannot be changed.



## Permissions

IAM Objects

The two types of IAM roles on GCP are primitive and curated/pre-defined.

Primitive roles (Viewer, Editor, Owner, Billing Administrator).

Permissions flow in one direction.
Parent permissions don't override child permissions. 
Instead, permissions are inherited and additive. 
Permissions can't be denied at lower levels once they've been granted at upper levels.

<a target="_blank" href="https://cloud.google.com/iam/docs/understanding-roles#predefined_roles">
Roles</a> (such as compute.instanceAdmin) are a collection of permissions to give access to a given resource, in the form:

   <em>service</em>.<em>resource</em>.<em>verb</em>

Applying an example:

   compute.instances.delete

IAM Policies 

Unlike an end-user account,
a service account is associated with a VM or app 
for use to authenticate from one service to another.
So no human authentication is involved.

Google-managed service accounts are of the format:<br />
<tt>[PROJECT_NUMBER]@cloudservices.gserviceaccount.com</tt>

User-managed service accounts are of the format:<br />
<tt>[PROJECT_NUMBER]-compute@developer.gserviceaccount.com</tt>

Service accounts have more stringent permissions and logging.


## Google CLIs

Google has three shells:

   1. <a href="#gcloudcli">gcloud CLI</a>

   2. gsutil to access Cloud Storage

   3. bq for Big Query tasks
   <br /><br />

There is a <a target="_blank" href="https://cloud.google.com/sdk/docs/quickstart-windows">
Google Cloud SDK for Windows (gcloud)</a> for your programming pleasure.

<a target="_blank" href="https://medium.com/google-cloud/graphical-user-interface-gui-for-google-compute-engine-instance-78fccda09e5c">
Graphical user interface (GUI) for Google Compute Engine instance</a>


<a name="gcloud"></a>

### Cloud Shell Online

   The Cloud Shell provides command line access on a web browser, 
   with nothing to install.

   Sessions have a 1 hour timeout.

   Language support for Java, Go, Python, Node, PHP, Ruby.

   Not meant for high computation use.


0. Click the icon in the Google Cloud Platform Console:

   ![gcp-cloud-shell-menu-568x166-9041](https://user-images.githubusercontent.com/300046/33441618-51ee28a0-d5b0-11e7-9d91-d122a5be5fe7.png)

0. Click "START CLOUD SHELL" at the bottom of this pop-up:

   ![gcloud-shell-entry-748x511](https://user-images.githubusercontent.com/300046/29963161-25e7f0e4-8ec3-11e7-9160-b0db113cf597.jpg)

   <a name="homedir"></a>

   When the CLI appears online:

0. See that your present working directory is `/home/` as your account name:

   <pre><strong>
   pwd
   </strong></pre>

   <pre><strong>
   echo ${HOME}
   </strong></pre>

   <pre><strong>
   echo ${USER}
   </strong></pre>

0. Read the welcome file:

   <pre><strong>
   nano README-cloudshell.txt
   </strong></pre>

Welcome to Google Cloud Shell, a tool for managing resources hosted on Google Cloud Platform!
The machine comes pre-installed with the Google Cloud SDK and other popular developer tools.

Your <a href="#5GB">5GB</a> <a href="#homedir">home directory</a> will persist across sessions, but the VM is ephemeral and will be reset
approximately 20 minutes after your session ends. No system-wide change will persist beyond that.

Type "gcloud help" to get help on using Cloud SDK. For more examples, visit
https://cloud.google.com/shell/docs/quickstart and 
https://cloud.google.com/shell/docs/examples

Type "cloudshell help" to get help on using the "cloudshell" utility.  Common functionality is
aliased to short commands in your shell, for example, you can type "dl &LT;filename>" at Bash prompt to
download a file. Type "cloudshell aliases" to see these commands.

Type "help" to see this message any time. Type "builtin help" to see Bash interpreter help.

Other resources:

   <a target="_blank" href="https://cloud.google.com/shell/docs">
   https://cloud.google.com/shell/docs</a>

### GCP Console / Dashboard

   <a target="_blank" href="https://console.cloud.google.com/home/dashboard">
   https://console.cloud.google.com/home/dashboard</a><br />
   displays panes for your project from among the list obtained by clicking the "hamburger" menu icon at the upper left corner.
   The major sections of this menu are:

   * <a href="#COMPUTE">COMPUTE</a> (App Engine, Compute Engine, Container Engine)
   * <a href="#STORAGE">STORAGE</a> (Cloud Bigtable, Cloud Datastore, Storage, Cloud SQL, Spanner)
   * <a href="#NETWORKING">NETWORKING</a> (VPC)
   * <a href="#STACKDRIVER">STACKDRIVER</a> (Monitoring, Debug, Trace, Logging, Error Reporting)
   * <a href="#TOOLS">TOOLS</a> (Container Registry, Source Repositories, Deployment Manager, Endpoints)
   * <a href="#BIGDATA">BIG DATA</a> (BigQuery, Pub/Sub, Dataproc, Dataflow, ML Engine, Genomics, IoT Core, Dataprep)


### Text Editor

0. Click the pencil icon for the built-in text editor.

0. Edit text using nano or vim built-in.

0. PROTIP: Boost mode to run Docker with more memory.


<a name="gcloudcli"></a>

### Local gcloud CLI install

Get the CLI to run locally on your laptop:

1. On MacOSX use Homebrew:
   <pre><strong>
   brew cask install google-cloud-sdk
   </strong></pre>


Alternately:

1. In https://cloud.google.com/sdk/downloads
2. Click the link for Mac OS X (x86_64) like "google-cloud-sdk-173.0.0-darwin-x86_64.tar.gz" to your Downloads folder.
3. Double-click the file to unzip it (from 13.9 MB to a 100.6 MB folder). If you're not seeing a folder in Finder, use another unzip utility.
4. Move the folder to your home folder.

Either way, edit environment variables on Mac:

1. Edit your ~/.bash_profile to add the path to that folder in the $PATH variable.

   <pre>export PATH="$PATH:$HOME/.google-cloud-sdk/bin"</pre>

0. PROTIP: Add an alias to get to the folder quickly:

   <pre>alias gcs='cd ~/.google-cloud-sdk'</pre>

0. Use the alias to navigate to the folder:

   <pre>gcs</pre>

   Set permissions?


0. Install libraries (without the help argument):<br />

   On Linux or Mac OS X:

   <pre>./install.sh --help</pre>

   On Windows:

   <pre>.\install.bat --help</pre>

0. Initialize the SDK:

   <pre>./bin/gcloud init</pre>


### gcloud CLI commands

Regardless of whether the CLI is online or local:

0. Get syntax of commands

   <tt><strong>gcloud help
   </strong></tt>

0. Be aware of the full set of parameters possible for GCP tasks at<br />
   <a target="_blank" href="https://cloud.google.com/sdk/gcloud/reference/">
   https://cloud.google.com/sdk/gcloud/reference</a> 
   
   The general format of commands:

   <tt>gcloud</tt> [GROUP] [GROUP] [COMMAND] -- arguments

   Has all Linux command tools and authentication pre-installed.

   <a name="5GB"></a>

0. Run `df` to see that /dev/sdb1 has 5,082,480 KB = 5GB of persistent storage:

   <pre>
Filesystem     1K-blocks     Used Available Use% Mounted on
none            25669948 16520376   7822572  68% /
tmpfs             872656        0    872656   0% /dev
tmpfs             872656        0    872656   0% /sys/fs/cgroup
/dev/sdb1        5028480    10332   4739672   1% /home
/dev/sda1       25669948 16520376   7822572  68% /etc/hosts
shm                65536        0     65536   0% /dev/shm
   </pre>

0. Confirm the operating system version:

   <tt><strong>uname -a
   </strong></tt>

   The answer is Debian 3.16:

   <pre>
    Linux cs-6000-devshell-vm-5260d9c4-474a-47de-a143-ea05b695c057-5a 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u5 (2017-09-19) x86_64 GNU/Linux
    </pre>


   gcloud compute config-ssh

   ### Projects List

   <a name="ProjectsList"></a>

0. Get list of Project IDs:

   <tt><strong>
   gcloud projects list
   </strong></tt>

   Example:

   <pre>
PROJECT_ID              NAME                       PROJECT_NUMBER
what-182518             CICD                       608556368368
   </pre>

0. List project name (aka "Friendly Name") such as "cp100".

   <pre><strong>gcloud config list project 
   </strong></pre>

   A sample response:

   <pre>
[core]
project = what-182518
Your active configuration is: [cloudshell-20786]
   </pre>

0. Print just the project name (suppressing other warnings/errors):

   <pre><strong>gcloud config get-value project 2> /dev/null 
   </strong></pre>

   Alternately:

   <pre><strong>gcloud config list --format 'value(core.project)' 2>/dev/null
   </strong></pre>

0. PROTIP: The shell variable $DEVSHELL_PROJECT_ID defined by Google can be used to refer to the project ID of the project used to start the Cloud Shell session.

   <tt><strong>
   echo $DEVSHELL_PROJECT_ID 
   </strong></tt>

0. PROTIP: Instead of manually constructing commands, use environment variable:

   <pre><strong>gcloud config set project ${DEVSHELL_PROJECT_ID}
   </strong></pre>

   Alternately, if you want your own:

   export PROJECT_ID=$(gcloud config get-value project)

0. PROTIP: Get information about a project using the project environment variable:

   <pre><strong>gcloud compute project-info describe --project ${DEVSHELL_PROJECT_ID}
   </strong></pre>

   Project metadata includes quotas:

   <pre>
quotas:
- limit: 1000.0
  metric: SNAPSHOTS
  usage: 1.0
- limit: 5.0
  metric: NETWORKS
  usage: 2.0
- limit: 100.0
  metric: FIREWALLS
  usage: 13.0
- limit: 100.0
  metric: IMAGES
  usage: 1.0
- limit: 1.0
  metric: STATIC_ADDRESSES
  usage: 1.0
- limit: 200.0
  metric: ROUTES
  usage: 31.0
- limit: 15.0
  metric: FORWARDING_RULES
  usage: 2.0
- limit: 50.0
  metric: TARGET_POOLS
  usage: 0.0
- limit: 50.0
  metric: HEALTH_CHECKS
  usage: 2.0
- limit: 8.0
  metric: IN_USE_ADDRESSES
  usage: 2.0
- limit: 50.0
  metric: TARGET_INSTANCES
  usage: 0.0
- limit: 10.0
  metric: TARGET_HTTP_PROXIES
  usage: 1.0
- limit: 10.0
  metric: URL_MAPS
  usage: 1.0
- limit: 5.0
  metric: BACKEND_SERVICES
  usage: 2.0
- limit: 100.0
  metric: INSTANCE_TEMPLATES
  usage: 1.0
- limit: 5.0
  metric: TARGET_VPN_GATEWAYS
  usage: 0.0
- limit: 10.0
  metric: VPN_TUNNELS
  usage: 0.0
- limit: 3.0
  metric: BACKEND_BUCKETS
  usage: 0.0
- limit: 10.0
  metric: ROUTERS
  usage: 0.0
- limit: 10.0
  metric: TARGET_SSL_PROXIES
  usage: 0.0
- limit: 10.0
  metric: TARGET_HTTPS_PROXIES
  usage: 1.0
- limit: 10.0
  metric: SSL_CERTIFICATES
  usage: 1.0
- limit: 100.0
  metric: SUBNETWORKS
  usage: 26.0
- limit: 10.0
  metric: TARGET_TCP_PROXIES
  usage: 0.0
- limit: 24.0
  metric: CPUS_ALL_REGIONS
  usage: 3.0
- limit: 10.0
  metric: SECURITY_POLICIES
  usage: 0.0
- limit: 1000.0
  metric: SECURITY_POLICY_RULES
  usage: 0.0
- limit: 6.0
  metric: INTERCONNECTS
  usage: 0.0
   </pre>
0. List configuration information for the currently active project:

   <tt><strong>gcloud config list
   </strong></tt>

   Sample response:

   <pre>
[component_manager]
disable_update_check = True
[compute]
gce_metadata_read_timeout_sec = 5
[core]
account = wilsonmar@gmail.com
check_gce_metadata = False
disable_usage_reporting = False
project = what-182518
[metrics]
environment = devshell
Your active configuration is: [cloudshell-20786]
   </pre>
   ### Account Authorization Permissions

0. List:

   <tt><strong>gcloud auth list
   </strong></tt>

   If you have not logged in:

   <pre>
No credentialed accounts.

To login, run:
  $ gcloud auth login `ACCOUNT`
</pre>

0. List projects to whch your account has access:

   <tt><strong>gcloud projects list
   </strong></tt>


   ### Instances List

   <a name="InstancesList"></a>

0. Zones are listed as metadata for each GCE instance:

   <tt><strong>gcloud compute instances list
   </strong></tt>

   Sample response:

   <pre>
NAME          ZONE           MACHINE_TYPE   PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP     STATUS
hygieia-1     us-central1-f  n1-standard-1               10.128.0.3   35.193.186.181  TERMINATED
   </pre>

   PROTIP: Define what Zone and region your team should use.


   ### Zones

0. Get list of zone codes in map ???:

   <tt><strong>
   gcloud compute zones list
   </strong></tt>

   Sample response:

   <pre>
NAME                    REGION                STATUS  NEXT_MAINTENANCE  TURNDOWN_DATE
asia-east1-c            asia-east1            UP
asia-east1-b            asia-east1            UP
asia-east1-a            asia-east1            UP
asia-northeast1-a       asia-northeast1       UP
asia-northeast1-c       asia-northeast1       UP
asia-northeast1-b       asia-northeast1       UP
asia-south1-c           asia-south1           UP
us-central1-c           us-central1           UP
asia-south1-a           asia-south1           UP
asia-south1-b           asia-south1           UP
asia-southeast1-a       asia-southeast1       UP
asia-southeast1-b       asia-southeast1       UP
australia-southeast1-c  australia-southeast1  UP
australia-southeast1-b  australia-southeast1  UP
australia-southeast1-a  australia-southeast1  UP
europe-west1-c          europe-west1          UP
europe-west1-b          europe-west1          UP
europe-west1-d          europe-west1          UP
europe-west2-b          europe-west2          UP
europe-west2-a          europe-west2          UP
europe-west2-c          europe-west2          UP
europe-west3-b          europe-west3          UP
europe-west3-a          europe-west3          UP
europe-west3-c          europe-west3          UP
southamerica-east1-c    southamerica-east1    UP
southamerica-east1-b    southamerica-east1    UP
southamerica-east1-a    southamerica-east1    UP
us-central1-a           us-central1           UP
us-central1-f           us-central1           UP
us-central1-c           us-central1           UP
us-central1-b           us-central1           UP
us-east1-b              us-east1              UP
us-east1-d              us-east1              UP
us-east1-c              us-east1              UP
us-east4-c              us-east4              UP
us-east4-a              us-east4              UP
us-east4-b              us-east4              UP
us-west1-c              us-west1              UP
us-west1-b              us-west1              UP
us-west1-a              us-west1              UP
   </pre>

   REMEMBER: Region is a higher-order (more encompassing concept) than Zone.

0. Define environment variables to hold zone and region:

   <pre><strong>
   export CLOUDSDK_COMPUTE_ZONE=us-central1-f
   export CLOUDSDK_COMPUTE_REGION=us-central1 
   echo $CLOUDSDK_COMPUTE_ZONE
   echo $CLOUDSDK_COMPUTE_REGION
   </strong></pre>

   TODO: Get the default region and zone into environment variables.

   curl "http://metadata.google.internal/computeMetadata/v1/instance/zone" -H "Metadata-Flavor: Google"

0. Set the zone (for example, us-east1-f defined above):

   <pre><strong>
   gcloud config set compute/zone ${CLOUDSDK_COMPUTE_ZONE}
   </strong></pre>

   See https://cloud.google.com/compute/docs/storing-retrieving-metadata

0. Switch to see the Compute Engine Metadata UI for the project:

   https://console.cloud.google.com/compute/metadata

   * google-compute-default-zone
   * google-compute-default-region
   <br /><br />

   https://github.com/wilsonmar/Dockerfiles/blob/master/gcp-set-zone.sh

## Create sample Node server

0. Download a file from GitHub:

   <pre><strong>
   curl -o https://raw.githubusercontent.com/wilsonmar/Dockerfiles/master/NodeJs/server.js
   </strong></pre>

   `-o` (lowercase o) saves the filename provided in the command line.

   See http://www.thegeekstuff.com/2012/04/curl-examples/?utm_source=feedburner

   The sample Node program displays just text "Hello World!" (no fancy HTML/CSS).

0. Invoke Node to start server:

   <pre><strong>node server.js</strong></pre>

0. View the program's browser output online by clicking the Google Web View button,
   then "Preview on port 8080":

   ![gcp-web-preview-396x236-5615](https://user-images.githubusercontent.com/300046/33445629-9e42da7a-d5ba-11e7-9bf1-fc3296a6071c.png)

   The URL:<br />
   https://8080-dot-3050285-dot-devshell.appspot.com/?authuser=0

0. Press control+C to stop the Node server.


## Enhance

   ### Database

   <pre><strong>gcloud sql instances patch mysql \
     --authorized-networks "203.0.113.20/32"
   </strong></pre>


   ### Deploy Python

0. Replace boilerplate "your-bucket-name" with your own project ID:

   sed -i s/your-bucket-name/$DEVSHELL_PROJECT_ID/ config.py

0. View the list of dependencies needed by your custom Python program:

   cat requirements.txt

0. Download the dependencies:

   pip install -r requirements.txt -t lib

0. Deploy the current assembled folder:

   gcloud app deploy -y

0. Exit the cloud:

   exit


### PowerShell Cloud Tools

https://cloud.google.com/powershell/

https://cloud.google.com/tools/powershell/docs/

0. In a PowerShell opened for Administrator:

    <tt><strong>
    Install-Module GoogleCloud
    </strong></tt>

   The response:

   <pre>
Untrusted repository
You are installing the modules from an untrusted repository. If you trust this 
repository, change its InstallationPolicy value by running the Set-PSRepository
 cmdlet. Are you sure you want to install the modules from 'PSGallery'?
[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help 
(default is "N"):
   </pre>

0. Click A.


0. Get all buckets for the current project, for a specific project, or a specific bucket:

   <pre>
   $currentProjBuckets = Get-GcsBucket
   $specificProjBuckets = Get-GcsBucket -Project my-project-1
   $bucket = Get-GcsBucket -Name my-bucket-name
   </pre>

0. Navigate to Google Storage (like a drive):

   cd gs:\

0. Show the available buckets (like directories):

   ls

0. Create a new bucket 

   mkdir my-new-bucket

0. Help

   Get-Help New-GcsBucket



<a name="TOOLS"></a>

## Source Code Repository

<a target="_blank" href="https://console.cloud.google.com/code/develop/repo">
https://console.cloud.google.com/code/develop/repo</a> is<br />
Google's (Source) Code Repository Console.

 served from:
<a target="_blank" href="https://gcr.io/">
gcr.io</a> 

See docs at <a target="_blank" href="https://cloud.google.com/source-repositories/">
https://cloud.google.com/source-repositories</a>

GCR is a full-featured Git repository hosted on GCP, free for up to 5 project-users per billing account, for up to 50GB free storage and 50GB free egress per month.

   <a name="MirrorGitHub"></a>

### Mirror from GitHub

   <a target="_blank" href="https://cloud.google.com/source-repositories/docs/connecting-hosted-repositories">NOTE</a>

1. PROTIP: On GitHub.com, login to the account you want to use (in the same browser).
0. PROTIP: Highlight and copy the name of the repository you want to mirror on Goggle.
0. Create another browser tab (so they share the credentials established in the steps above).
0. <a target="_blank" href="https://console.cloud.google.com/code/">
   https://console.cloud.google.com/code</a> is the Google Code Console.
0. Click "Get Started" if it appears.
0. PROTIP: For repository name, paste or type the same name as the repo you want to hold from GitHub.

   BLAH: Repository names can only contain alphanumeric characters, underscores or dashes.

0. Click CREATE to confirm name.

   ![gcp-code-github-925x460](https://user-images.githubusercontent.com/300046/31047047-c37d31d4-a5c0-11e7-895a-2e8576120964.jpg)

0. Click on "Automatically Mirror from GitHub". 
0. Select GitHub or Bitbucket for a "Choose a Repository list".
0. Click Grant to the repo to be linked (if it appears). Then type your GitHub password.
0. Click the green "Authorize Google-Cloud-Development" button.
0. Choose the repository. Click the consent box. CONNECT.

   You should get an email "[GitHub] A new public key was added" about the Google Connected Repository.

0. Commit a change to GitHub (push from your local copy or interactively on GitHub.com).
0. Click the clock icon on Google Code Console to toggle commit history.
0. Click the SHA hash to view changes.
0. Click on the changed file path to see its text comparing two versions. Scroll down.
0. Click "View source at this commit" to make a "git checkout" of the whole folder.
0. Click the "Source code" menu for the default list of folders and files.
0. Select the master branch.

   To disconnect a hosted repository:

0. Click Repositories on the left menu.
0. Click the settings icon (with the three vertical dots to the far right) on the same line of the repo you want disconnected.
0. Confirm Disconnect.


   ### Create new repo in CLI

0. Be at the project you want.
0. Create a repository.
0. Click the CLI icon. 
0. Click the wrench to adjust backgroun color, etc.

0. Create a file using the source browser.

0. Make it a Git repository (a Git client is built-in):

   <tt><strong>
   gcloud init
   </strong></tt>

0. Define, for example:

   <tt><strong>
   git config credential.helper gcloud.sh
   </strong></tt>

0. Define the remote:

   <tt><strong>
   git remote add google \
   https://source.developers.google.com/p/cp100-1094/r/helloworld
   </strong></tt>

0. Define the remote:

   <tt><strong>
   git push \-\-all google
   </strong></tt>

0. To transfer a file within gcloud CLI:

   <tt><strong>
   gsutil cp \*.txt gs://cp-100-demo
   </strong></tt>



### GCR Container Registry

<a target="_blank" href="https://console.cloud.google.com/gcr/">
https://console.cloud.google.com/gcr - Google's Container Registry console</a>
is used to control what is in  
<a target="_blank" href="https://cloud.google.com/container-registry/">
Google's <strong>Container Registry</strong> (GCR)</a>.
It is a service apart from GKE.
It stores secure, private Docker images for deployments. 

Like GitHub, it has build triggers.

<a target="_blank" href="https://cloud.google.com/container-registry/?hl=en_US&_ga=2.161668348.-1771618146.1506638659">
help</a>


### Deployment Manager

Deployment Manager creates resources.

Cloud Launcher
uses .yaml templates describing the environment makes for repeatability.


### Endpoints (APIs)

<a target="_blank" href="https://cloud.google.com/endpoints/?hl=en_US&_ga=2.173800291.-1771618146.1506638659">
Google Cloud Endpoints</a> let you manage, control access, and monitor 
custom APIs that can be kept private.


## REST API

0. Enable the API on Console.

0. For more on working with Google API Explorer to test RESTful API's

   <a target="_blank" href="https://developers.google.com/apis-explorer">
   https://developers.google.com/apis-explorer</a>

   PROTIP: Although APIs are in alphabetical order, some services are named starting with "Cloud" or "Google" or "Google Cloud". Press Ctrl+F to search.

SQL Servers on GCE: (2012, 2014, 2016)

   * SQL Server Standard 
   * SQL Server Web 
   * SQL Server Enterprise
   <br /><br />

API Explorer site: GCEssentials_ConsoleTour

Authentication using OAuth2 (JWT), JSON.



<a name="NETWORKING"></a>

## Google NETWORKING

Google creates all instances with a private (internal) IP address such as 10.142.3.2.

One public IP (such as 35.185.115.31) is optionally created to a resource.
The IP can be ephemeral (from a pool) or static (reserved).
Unassigned static IPs cost $.01 per hour (24 cents per day).

Connect vis VPN using IPsec to encrypt traffic.

Google Cloud Router supports dynamic routing between Google Cloud Platform and corporate networks

HTTP Load Balancing ensures only healthy instances handle traffic across regions.

Google Cloud Interconnect:

   * Carrier Interconnect - Enterprise-grade connections provided by carrier service providers
   * Direct Peering - connect business directly to Google
   * CDN Interconnect - CDN providers link with Google's edge network
   <br /><br />

### Allow external traffic k8s

For security, k8s pods by default are accessible only by its internal IP within the cluster. 

So to make a container accessible from outside the Kubernetes virtual network, expose the pod as a Kubernetes service. Within a Cloud Shell:

   <pre><strong>kubectl expose deployment hello-node --type="LoadBalancer"
   </strong></pre>

   The --type="LoadBalancer" flag specifies that we'll be using the load-balancer provided by the underlying infrastructure (in this case the Compute Engine load balancer).
   To load balance traffic across all pods managed by the deployment.

   Sample response:

   <pre>
   service "hello-node" exposed
   </pre>

   The Kubernetes master creates the load balancer and related Compute Engine forwarding rules, target pools, and firewall rules to make the service fully accessible from outside of Google Cloud Platform.

0. Find the publicly-accessible IP address of the service, request kubectl to list all the cluster services:

   <pre><strong>kubectl get services
   </strong></pre>

   Sample response listing internal CLUSTER-IP and EXTERNAL-IP:

   <pre>
NAME         CLUSTER-IP     EXTERNAL-IP      PORT(S)    AGE
hello-node   10.3.250.149   104.154.90.147   8080/TCP   1m
kubernetes   10.3.240.1     &LT;none>           443/TCP    5m
   </pre>



<a name="COMPUTE"></a>

## Google COMPUTE Cloud Services

![gcloud-offerings-600x120-48k](https://user-images.githubusercontent.com/300046/29748808-c13564d6-8aeb-11e7-8415-a265b34e9997.jpg)

From the left, IaaS raw controlled by you to the right a PaaS highly managed by Google for <strong>"NoOps"</strong>.

<table border="1" cellpadding="4" cellspacing="0">
   <tr valign="bottom"><th> &nbsp;</th><th>Compute Engine</th><th>Container<br />Engine</th><th>App Engine<br />Standard</th><th>App Engine<br />Flexible</th></tr>
   <tr valign="top"><td> Service model </td><td> Iaas </td><td>Hybrid</td><td colspan="2">Paas</td></tr>
   <tr valign="top"><td> Language support </td><td> Any </td><td>Any</td><td>Java, Python, Go, PHP</td><td>Any</td></tr>
   <tr valign="top"><td> Primary use case workloads</td><td> General computing </td><td>Container-based</td><td>Web & Mobile apps</td><td>Container-based</td></tr>
</table>

https://cloudplatform.googleblog.com/2017/07/choosing-the-right-compute-option-in-GCP-a-decision-tree.html

The <strong>engines</strong> of GCP:

* <a href="#GCE">Compute Engine</a> - full control of VMs for Linux and Windows Server. The API controls addresses, autoscalars, backend, disks, firewalls, global Forwarding, health, images, instances, projects, region, snapshots, ssl, subnetworks, targets, vpn, zone, etc.

* <a href="#GCF">Google Cloud Functions - serverless platform for single-purpose microservices written in JavaScript executed in Node.js when triggered by events

* <a href="#GAE">App Engine</a> - deploy code for Google to scale

* <a href="#GKE">Kubernetes Engine</a> - Kubernetes-based container clustering



<a name="GCE"></a>

### Google Compute Engine

GCE offers the most <strong>control</strong> but also the most work (operational overhead).

Preemptible instances are cheaper but can be taken anytime, like Amazon's.

Google provides load balancers, VPNs, firewalls.

Use GCE where you need to select the size of disks, memory, CPU types 

* use GPUs (Graphic Processing Units)
* custom OS kernels
* specifically <strong>licensed</strong> software
* protocols beyond HTTP/S
* orchestration of multiple containers
<br /><br />

GCE is called a IaaS (Infrastructure as a Service) offering of <strong>instances</strong>, 
NOT using Kubernetes automatically like GKC. Use it to migrate on-premise solutions to cloud.

https://cloud.google.com/compute/docs/?hl=en_US&_ga=2.131668815.-1771618146.1506638659

<a target="_blank" href="https://stackoverflow.com/questions/tagged/google-compute-engine">
https://stackoverflow.com/questions/tagged/google-compute-engine</a>

https://cloud.google.com/compute/docs/machine-types
such as `n1-standard-1`.


<a name="GCE-SonarQube"></a>

### GCE SonarQube

There are several ways to instantiate a Sonar server.


<a name="GCE-SonarQubeBitNami"></a>

#### GCE SonarQube BitNami

One alternative is to use Bitnami 

1. Browser at https://google.bitnami.com/vms/new?image_id=4FUcoGA
0. Click Account for https://google.bitnami.com/services
0. Add Project
0. Setup a BitName Vault password. 
0. PROTIP: Use 1Password to generate a strong password and store it.
0. Agree to really open sharing with Bitnami:

   * View and manage your Google Compute Engine resourcesMore info
   * View and manage your data across Google Cloud Platform servicesMore info
   * Manage your data in Google Cloud StorageMore info

   CAUTION: This may be over-sharing for some.

0. Click "Select an existing Project..." to select one in the list that appears. Continue.
0. Click "Enable Deployment Manager (DM) API" to open another browser tab at https://console.developers.google.com/project/attiopinfosys/apiui/apiview/deploymentmanager
0. If the blue "DISABLE" appears, then it's enabled.
0. Return to the Bitnami tab to click "CONTINUE".
0. Click BROWSE for the Library at https://google.bitnami.com/

   The above is done one time to setup your account.

0. Type "SonarQube" in the search field and click SEARCH.
0. Click on the icon that appears to LAUNCH.
0. Click on the name to change it.
0. NOTE "Debian 8" as the OS cannot be changed.
0. Click "SHOW" to get the password into your Clipboard. wNTzYLkM1sGX
0. Wait for the orange "REBOOT / SHUTDOWN / DELETE" to appear at the bottom of the screen.

   Look:

0. Click "LAUNCH SSH CONSOLE".
0. Click to confirm the SSH pop-up.
0. Type `lsb_release -a` for information about the operating system:

   <pre>
No LSB modules are available.
Distributor ID: Debian
Description:    Debian GNU/Linux 8.9 (jessie)
Release:        8.9
Codename:       jessie
   </pre>

   PROTIP: This is not the very latest operating system version because it takes time to integrate.

0. Type `pwd` to note the user name (carried in from Google).
0. Type `ls -al` for information about files:

   <pre>
apps -> /opt/bitnami/apps
.bash_logout
.bashrc
.first_login_bitnami
htdocs -> /opt/bitnami/apache2/htdocs
.profile
.ssh
stack -> /opt/bitnami
   </pre>

0. Type `exit` to switch back to the browser tab.
0. Click the blue IP address (such as 35.202.3.232) for a SonarQube tab to appear.

0. Type "Admin" for user. Click the Password field and press Ctrl+V to paste from Clipboard. 
0. Click "Log in" for the Welcome screen.

   TODO: Assign other users.

0. TODO: Associate the IP with a host name.


   <a name="SonarRun"></a>

   #### SonarQube app admin log in

0. At SonarQube server landing page (such as http://23.236.48.147)

   You may need to add it as a security exception. VMxatH6wcr2g

0. Type a name of your choosing, then click Generate.

0. Click the language (JS).
0. Click the OS (Linux, Windows, Mac).
0. Highlight the sonar-scanner command to copy into your Clipboard.

0. Click Download for https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner

   ![sonarqube-clientinstall-386x292-27346](https://user-images.githubusercontent.com/300046/31867276-0c481620-b752-11e7-8276-984e93fd4562.jpg)

   On a Windows machine:<br />
   sonar-scanner-cli-3.0.3.778-windows.zip | 63.1 MB

   On a Mac:<br />
   sonar-scanner-cli-3.0.3.778-macosx.zip | 53.9 MB

0. Generate the token:

   ![sonarqube-gen-token-601x129-14487](https://user-images.githubusercontent.com/300046/31867296-91de588a-b752-11e7-8788-44ac662a2a71.jpg)

0. Click Finish to see the server page such as at http://35.202.3.232/projects

   #### Do a scan

0. On your Mac, unzip to folder "sonar-scanner-3.0.3.778-macosx".
  
   Notice it has its own Java version in the jre folder.

0. Open a Terminal and navigate to the bin folder containing `sonar-scanner`.
0. Move it to a folder in your PATH.
0. Create or edit shell script file from the Bitnami screen:

   <pre>
./sonar-scanner \
  -Dsonar.projectKey=sonarqube-1-vm \
  -Dsonar.sources=. \
  -Dsonar.host.url=http://23.236.48.147 \
  -Dsonar.login=b0b030cd2d2cbcc664f7c708d3f136340fc4c064
   </pre>

   NOTE: Your login token will be different than this example.

   https://github.com/wilsonmar/git-utilities/.../sonar1.sh

0. Replace the . with the folder path such as 

   `-Dsonar.sources=/Users/wilsonmar/gits/ng/angular4-docker-example`

   Do this instead of editing `/conf/sonar-scanner.properties` to change default `http://localhost:9000`

0. chmod 555 sonar.sh
0. Run the sonar script.

0. Wait for the downloading.
0. Look for a line such as:

   <pre>
INFO: ANALYSIS SUCCESSFUL, you can browse http://35.202.3.232/dashboard/index/Angular-35.202.3.232
   </pre>

0. Copy the URL and paste it in a browser.

0. PROTIP: The example has no Version, Tags, etc. that a "production" environment would use.


#### GCE SonarQube 

1. In the GCP web console, navigate to the screen where you can create an instance.

   https://console.cloud.google.com/compute/instances

0. Click Create (a new instance).
0. Change the instance name from `instance-1` to `sonarqube-1` (numbered in case you'll have more than one).
0. Set the zone to your closest geographical location (`us-west1-a`).
0. Set machine type to `f1-micro`.
0. Click Boot Disk to select `Ubuntu 16.04 LTS` instead of default `Debian GNU/Linux 9 (stretch)`.

   PROTIP: GCE does not provide the lighter http://alpinelinux.org/

0. Type a larger Size (GB) than the default 10 GB.

   <pre>
   WARNING: You have selected a disk size of under [200GB]. This may result in poor I/O performance. For more information, see: https://developers.google.com/compute/docs/disks#performance.
   </pre>

0. Set <a target="_blank" href="https://cloud.google.com/compute/docs/vpc/using-firewalls">Firewall rules</a> to allow Ingree and Egress through external access to ports:

   9000:9000 -p 9092:9092 sonarqube

0. Allow HTTP & HTPPS traffic.
0. Click "Management, disks, networking, SSH keys".
0. In the <strong>Startup script</strong> field, paste script you've tested interactively:

   <pre>
   # Install Docker: 
   curl -fsSL https://get.docker.com/ | sh
   sudo docker pull sonarqube
   sudo docker run -d --name sonarqube -p 9000:9000 -p 9092:9092 sonarqube
   </pre>

0. Click "command line" link for a pop-up of the equivalent command.
0. Copy and paste it in a text editor to save the command for troubleshooting later.

0. Click <strong>Create</strong> the instance. This <a target="_blank" href="https://cloudplatform.googleblog.com/2017/07/three-steps-to-Compute-Engine-startup-time-bliss-Google-Cloud-Performance-Atlas.html">cold-boot takes time</a>:

   ![gce-startup-time-640x326](https://user-images.githubusercontent.com/300046/31769426-262e939a-b499-11e7-8c7d-7e4bf0057107.png)

   Boot time to execute startup scripts is the variation <a target="_blank" href="https://goo.gl/S0AS51">cold-boot performance</a>.

0. Click SSH to SSH into instance via the web console, using your Google credentials.
0. In the new window, `pwd` to see your account home folder.
0. To see instance console history:

   `cat /var/log/syslog`


   #### Manual startup setup

   https://cloud.google.com/solutions/mysql-remote-access

0. If there is a UI, highlight and copy the <strong>external IP address</strong> (such as https://35.203.158.223/) and switch to a browser to paste on a browser Address.

0. Add the port number to the address.

   BLAH TODO: Port for UI?  

   TODO: Take a VM snapshot.

   https://cloud.google.com/solutions/prep-container-engine-for-prod

   #### Down the instance

0. <a target="_blank" href="https://www.digitalocean.com/community/tutorials/how-to-remove-docker-images-containers-and-volumes">Remove image containers and volumes</a>

0. When done, close SSH windows.
0. If you gave out and IP address, notify recipients about their imminent deletion.
0. In the Google Console, click on the three dots to <strong>delete</strong> the instance.

   Colt McAnlis (<a target="_blank" href="https://twitter.com/duhroach">@duhroach</a>), Developer Advocate explains Google Cloud performance (enthusiastically) at https://goo.gl/RGsQlF


https://www.youtube.com/watch?v=ewHxl9A0VuI&index=2&list=PLIivdWyY5sqK5zce0-fd1Vam7oPY-s_8X

#### GCE SonarQube Command



#### Windows

https://github.com/MicrosoftDocs/Virtualization-Documentation

   On Windows, output from Start-up scripts are at
   C:\Program Files\Google\Compute Engine\sysprep\startup_script.ps1


<a name="GKE"></a>

## Kubernetes Engine

<a target="_blank" href="https://console.cloud.google.com/kubernetes/">
<img align="right" alt="gce-console-menu-244x241-11754" width="244" height="241" src="https://user-images.githubusercontent.com/300046/31014930-a8b77274-a4da-11e7-921f-5ff139a5e527.jpg"></a>

To reduce confusion, this was previously renamed from GKE (Google Container Engine).
The "K" is there because GKE is powered by [Kubernetes](/kubernetes/), Google's container orchestration manager, providing compute services above Google Compute Engine (GCE). 

1. "Kubernetes" is in the URL to the GKE home page:

   <a target="_blank" href="https://console.cloud.google.com/kubernetes/">
   https://console.cloud.google.com/kubernetes</a>

0. Click "Create Cluster".
0. PROTIP: Rename generated "cluster-1" to contain the zone.
0. Select zone where your others are.
0. Note the default is Container-Optimized OS (based on Chromium OS) and 
   3 minion nodes in the cluster, which does not include the master.

   Workload capacity is defined by the number of Compute Engine worker <strong>nodes</strong>.

   The cluster of nodes are controlled by a <strong>K8S master</strong>.

0. PROTIP: Attach a permanent disk for persistence.
0. Click Create. Wait for the green checkmark to appear.
0. Connect to the cluster. Click the cluster name to click CONNECT to Connect using Cloud Shell the CLI.

0. Create a cluster called "bootcamp":

 gcloud container clusters create bootcamp --scopes "https://www.googleapis.com/auth/projecthosting,storage-rw"

   <pre>
   gcloud container clusters get-credentials cluster-1 \
      --zone us-central1-f \
      --project ${DEVSHELL_PROJECT_ID}
   </pre>

   The response:

   <pre>
Fetching cluster endpoint and auth data.
kubeconfig entry generated for cluster-1.
   </pre>

0. Invoke the command:

   <pre><strong>
   kubectl get nodes
   </strong></pre>

   If the get the following message:

   <pre>The connection to the server localhost:8080 was refused - did you specify the right host or port?
   </pre>

   Sample valid response:

   <pre>
NAME                                       STATUS    ROLES     AGE       VERSION
gke-cluster-1-default-pool-8a05cb05-701j   Ready     &LT;none>    11m       v1.7.8-gke.0
gke-cluster-1-default-pool-8a05cb05-k4l3   Ready     &LT;none>    11m       v1.7.8-gke.0
gke-cluster-1-default-pool-8a05cb05-w4fm   Ready     &LT;none>    11m       v1.7.8-gke.0
   </pre>

0. List and expand the width of the screen:

   <pre><strong>
   gcloud container clusters list
   </strong></pre>

   Sample response:

   <pre>
NAME       ZONE           MASTER_VERSION  MASTER_IP       MACHINE_TYPE   NODE_VERSION  NUM_NODES  STATUS
cluster-1  us-central1-f  1.7.8-gke.0     162.222.177.56  n1-standard-1  1.7.8-gke.0   3          RUNNING
   </pre>

   If no clusters were created, no response is returned.

0. Highlight the Endpoint IP address, copy, and paste to construct a browser URL such as:

   https://162.222.177.56/ui

   BLAH: 
   User "system:anonymous" cannot get path "/".: "No policy matched.\nUnknown user \"system:anonymous\""

0. In the Console, click Show Credentials.
0. Highlight and copy the password.

0. Start

   <pre><strong>
   kubectl proxy
   </strong></pre>

   The response:

   <pre>Starting to serve on 127.0.0.1:8001</pre>

   WARNING: You are no longer able to issue commands while the proxy runs.

<hr />

0. Create new pod named "hello-node":

   <pre><strong>
kubectl run hello-node \
    --image=gcr.io/${DEVSHELL_PROJECT_ID}/hello-node:v1 \
    --port=8080
   </strong></pre>

   Sample response:

   <pre>deployment "hello-node" created</pre>

0. View the pod just created:

   <pre><strong>
   kubectl get pods
   </strong></pre>

   Sample response:

   <pre>
NAME                         READY     STATUS    RESTARTS   AGE
hello-node-714049816-ztzrb   1/1       Running   0          6m
   </pre>

0. List

   <pre><strong>
   kubectl get deployments
   </strong></pre>

   Sample response:

   <pre>
NAME         DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
hello-node   1         1         1            1           2m
   </pre>

0. Troubleshoot:

   kubectl get events

   kubectl get services

0. Get logs:

   kubectl logs <em>pod-name</em>

0. Other commands:

   kubectl cluster-info

   kubectl config view


### Kubernetes Dashboard

Kubernetes graphical dashboard (optional)

0. Configure access to the Kubernetes cluster dashboard:

   <pre><strong>gcloud container clusters get-credentials hello-world \
    --zone us-central1-f --project ${DEVSHELL_PROJECT_ID}
   </strong></pre>

   Sample response:

   <pre>
kubectl proxy --port 8086
   </pre>

0. Use the Cloud Shell Web preview feature to view a URL such as:

   https://8081-dot-3103388-dot-devshell.appspot.com/ui

0. Click the "Connect" button for the cluster to monitor.

   See http://kubernetes.io/docs/user-guide/ui/


<hr />

1. Begin in "APIs & Services" because Services provide a single point of access (load balancer IP address and port) to specific pods.
0. Click ENABLE...
0. Search for Container Engine API and click it. 
0. In the gshell: `gcloud compute zones list`


   #### Create container cluster

0. Select Zone
0. Set "Size" (vCPUs) from 3 to 2 -- the number of <strong>nodes</strong> in the cluster.

   Nodes are the primary resource that runs services on Google Container Engine.

0. Click More to expand.
0. Add a <strong>Label</strong> (up 60 64 per resource):

   Examples: env:prod/test, owner:, contact:, team:marketing, component:backend, state:inuse.

   The size of boot disk, memory, and storage requirements can be adjusted later.

0. Instead of clicking "Create", click the "command" link for the equivalent the gcloud CLI commands in the pop-up.

   <pre>
gcloud beta container --project "mindful-marking-178415" clusters create "cluster-1" --zone "us-central1-a" --username="admin" --cluster-version "1.7.5-gke.1" --machine-type "n1-standard-1" --image-type "COS" --disk-size "100" --scopes "https://www.googleapis.com/auth/compute","https://www.googleapis.com/auth/devstorage.read_only","https://www.googleapis.com/auth/logging.write","https://www.googleapis.com/auth/monitoring.write","https://www.googleapis.com/auth/servicecontrol","https://www.googleapis.com/auth/service.management.readonly","https://www.googleapis.com/auth/trace.append" --num-nodes "2" --network "default" --no-enable-cloud-logging --no-enable-cloud-monitoring --subnetwork "default" --enable-legacy-authorization
   </pre>

   PROTIP: Machine-types are listed and described at 
   https://cloud.google.com/compute/docs/machine-types

   Alternately,

   <pre><strong>
gcloud container clusters create bookshelf \
  --scopes "https://www.googleapis.com/auth/userinfo.email","cloud-platform" \
  --num-nodes 2
   </strong></pre>

   The response sample (widen window to see it all):

   <pre>
Creating cluster cluster-1...done.
Created [https://container.googleapis.com/v1/projects/mindful-marking-178415/zones/us-central1-a/clusters/cluster-1].
kubeconfig entry generated for cluster-1.
NAME       ZONE           MASTER_VERSION  MASTER_IP      MACHINE_TYPE   NODE_VERSION  NUM_NODES  STATUS
cluster-1  us-central1-a  1.7.5-gke.1     35.184.10.233  n1-standard-1  1.7.5         2          RUNNING
   </pre>


0. Push

   <tt><strong>
   gcloud docker -- push gcr.io/$DEVSHELL_PROJECT_ID/bookshelf
   </strong></tt>

0. Configure entry credentials 

   gcloud container clusters get-credentials bookshelf

0. Use the <a target="_blank" href="https://kubernetes.io/docs/user-guide/kubectl-overview/">
   kubectl</a> command line tool.

   kubectl create -f bookshelf-frontend.yaml

0. Check status of pods

   kubectl get pods

0. Retrieve IP address:

   kubectl get services bookshelf-frontend


   <a name="DestroyCluster"></a>

   #### Destroy cluster

   It may seem a bit premature at this point, but since Google charges by the minute, it's better you know how to do this earlier than later. Return to this later if you don't want to continue.

0. Using the key information from the previous command:

   <tt><strong>
    gcloud container clusters delete cluster-1 --zone us-central1-a
   </strong></tt>


   #### 2). View cloned source code for changes

0. Use a text editor (vim or nano) to define a .yml file to define what is in pods.

0. Build Docker

   <tt><strong>docker build -t gcr.io/${DEVSHELL_PROJECT_ID}/hello-node:v1 .
   </strong></tt>

   Sample response:

   <pre>
   v1: digest: sha256:6d7be8013acc422779d3de762e8094a3a2fb9db51adae4b8f34042939af259d8 size: 2002
   ...
   Successfully tagged gcr.io/cicd-182518/hello-node:v1
   </pre>

0. Run:

   <pre><strong>docker run -d -p 8080:8080 gcr.io/${DEVSHELL_PROJECT_ID}/hello-node:v1
   </strong></pre>

   No news is good news in the response.

0. Web Preview on port 8080 specified above.

0. List Docker containers images built:

   <pre><strong>docker ps</strong></pre>

   <pre>
CONTAINER ID        IMAGE                              COMMAND                  CREATED              STATUS              PORTS                    NAMES
c938f3b42443        gcr.io/cicd-182518/hello-node:v1   "/bin/sh -c 'node ..."   About a minute ago   Up About a minute   0.0.0.0:8080->8080/tcp   cocky_kilby
   </pre>

0. Stop the container by using the ID provided in the results above:

   <pre><strong>docker stop c938f3b42443</strong></pre>

   The response is the CONTAINER_ID.

   https://cloud.google.com/sdk/docs/scripting-gcloud

0. Run the image:

   <pre><strong>docker run -d -p 8080:8080 gcr.io/${DEVSHELL_PROJECT_ID}/hello-node:v1
   </strong></pre>

   The response is a hash of the instance.

0. Push the image to grc.io repository:

   <pre><strong>gcloud docker -- push gcr.io/${DEVSHELL_PROJECT_ID}/hello-node:v1
   </strong></pre>

   v1: digest: sha256:98b5c4746feb7ea1c5deec44e6e61dfbaf553dab9e5df87480a6598730c6f973 size: 10025



<hr />

   <pre><strong>gcloud config set container/cluster ...
   </strong></pre>

3). Cloud Shell instance - Remove code placeholds

4). Cloud Shell instance - package app into a Docker container

 5). Cloud Shell instance - Upload the image to Container Registry

 6). Deploy app to cluster

See https://codelabs.developers.google.com/codelabs/cp100-container-engine/#0


<a name="GAE"></a>

### Google App Engine (GAE)

GAE is a PaaS (Platform as a Service) offering 
where Google manages application infrastucture (Jetty 8, Servlet 3.1, .Net Core, NodeJs)
that responds to <strong>HTTP requests</strong>.

Google Cloud Endpoints provide scaling, HA, DoS protection, TLS 1.2 SSL certs for HTTPS.

The first 26 GB of traffic each month is free.

Develop server-side code in Java, Python, Go, PHP.

Customizable 3rd party binaries are supported with SSH access on <a target="_blank" href="https://cloud.google.com/appengine/docs/flexible/">
GAE Flexible Enviornment</a>
which also enables write to local disk.

https://cloud.google.com/appengine/docs?hl=en_US&_ga=2.237246272.-1771618146.1506638659

<a target="_blank" href="https://stackoverflow.com/questions/tagged/google-app-engine">
https://stackoverflow.com/questions/tagged/google-app-engine</a>


<a name="GCF"></a>

### Google Cloud Functions

Here, single-purpose <strong>functions</strong> are coded in JavaScript and executed in <strong>NodeJs</strong>
when triggered by <strong>events</strong> occuring, such as a file upload.

Google provides a "Serverless" environment 
for building and connecting cloud services on a web browser.


<a name="GFirebase"></a>

### Google Firebase

Handles HTTP requests on mobile devices.



<a name="STORAGE"></a>

## Google Cloud Storage (GCS)

<!-- https://www.coursera.org/learn/gcp-fundamentals/lecture/ZruAR/demo-of-storage-options 
-->

In gcloud on a project:

0. Create a bucket in location ASIA, EU, or US, in this example:

   <tt><strong>gsutil mb -l US gs://$DEVSHELL_PROJECT_ID
   </strong></tt>

0. Grant Default <a target="_blank" href="https://developers.google.com/bigquery/docs/data%23aclsandrights">
   ACL (Access Control List)</a> to All users:

   <tt><strong>gsutil defacl ch -u AllUsers:R gs://$DEVSHELL_PROJECT_ID
   </strong></tt>

   The response:

   <pre>Updated default ACL on gs://cp100-1094/
   </pre>

![gcp-storage-table-650x270-42645](https://user-images.githubusercontent.com/300046/31043498-0da3e3a8-a57a-11e7-897e-8212079dcbfb.jpg)

<table>
   <tr><th>&nbsp;</th><th> Cloud Storage</th><th>Cloud Datastore</th><th>Bigtable</th><th>Cloud SQL (1stGen)</th></tr>
   <tr><td>Storage type</td><td>BLOB store</td><td>NoSQL, document</td><td>wide column NoSQL</td><td>Relational SQL</td></tr>
   <tr><td>Overall capacity</td><td>Petabytes+</td><td>Terabytes+</td><td>Petabytes+</td><td>Up to 500 GB</td></tr>
   <tr><td>Unit size</td><td>5 TB/<br />object</td><td>1 MB/<br />entity</td><td>10 MB/<br />cell</td><td>standard</td></tr>
   <tr><td>Transactions</td><td>No</td><td>Yes</td><td>No</td><td>Yes</td></tr>
   <tr><td>Complex queries</td><td>No</td><td>No</td><td>No</td><td>Yes</td></tr>
</table>


<a target="_blank" href="https://stackoverflow.com/questions/tagged/google-cloud-storage">
https://stackoverflow.com/questions/tagged/google-cloud-storage</a>


## Google DataStore

Provides a RESTful interface for NoSQL ACID transactions.



### Cloud storage bucket classes

Standard storage for highest durability, availability, and performance with low latency, for web content distribution and video streaming.

* (Standard) multi-regional to accessing media around the world.
* (Standard) Regional to store data and run data analytics in a single part of the world.
* Nearline strage for low-cost but durable data archiving, online backup, disaster recovery of data rarely accessed.
* Coldline storage = DRA (Durable Reduced Availability Storage) at a lower cost for once per year access.
<br /><br />


### Google Cloud SQL (GCS)

Google's Cloud SQL is MySQL in the cloud, and scale up to 16 processor cores and 100 GB RAM.

Google provides automatic replicas, backups, and patching.

App Engine access Cloud SQL databases using drivers Connector/J for Java and MySQLdb for Python.

   * git clone https://github.com/GoogleCloudPlatform/appengine-gcs-client.git

   * https://cloud.google.com/appengine/docs/python/googlecloudstorageclient/using-cloud-storage
   * https://cloud.google.com/sdk/cloud-client-libraries for Python
   <br /><br />

Tools like Toad can be used to administser Cloud SQL databases.

   <a target="_blank" href="https://stackoverflow.com/questions/tagged/google-cloud-sql">
   https://stackoverflow.com/questions/tagged/google-cloud-sql</a>


<a name="Stackdriver"></a>

## Stackdriver for Logging

"Stackdriver" GCP's tool for logging, monitoring, error reporting, trace, diagnostics that's integrated across GCP and AWS.

Trace provides per-URL latency metrics.

Open source agents

Collaborations with PagerDuty, BMC, Spluk, etc.

Integrate with auto-scaling.

Integrations with Source Repository for debugging.


<a name="BIGDATA"></a>

## Big Data Services

<a target="_blank" href="https://user-images.githubusercontent.com/300046/30033965-bd70b7a8-915b-11e7-9aba-9c2cbf5f62e8.png">
<img alt="gcp-decision-tree.png" src="https://user-images.githubusercontent.com/300046/30033965-bd70b7a8-915b-11e7-9aba-9c2cbf5f62e8.png"><small>Click to pop-up image</small></a>

BigQuery data wharehouse analytics database streams data at 100,000 rows per second. Automatic discounts for long term data storage. See Shine Technologies.

   (HBase - columnar data store
   Pig
   RDBMS 
   indexing
   hashing)

   Storage costs 2 cents per BigTable per month. No charge for queries from cache!

   Competes against Amazon Redshift.

   <a target="_blank" href="https://stackoverflow.com/questions/tagged/google-bigquery">
   https://stackoverflow.com/questions/tagged/google-bigquery</a>


Pub/Sub enterprise messaging for IoT. scalable & flexible. Integrates with Dataflow.

Dataflow - stream analytics & ETL batch processing  - unified and simplified <strong>pipelines</strong> in Java and Python. Use reserved compute instances. Competitor in AWS Kinesis.


Dataproc - managed Hadoop, Spark, MapReduce, Hive service

ML Engine, Genoics, IoT Core, Dataprep)

Datalab is a Jupyter notebook server using matplotlib or Goolge Charts for <strong>visualization</strong>. It provides an interactive tool for large-scale data exploration, transformation, analysis, 



## .NET Dev Support

https://www.coursera.org/learn/develop-windows-apps-gcp
Develop and Deploy Windows Applications on Google Cloud Platform
class on Coursera

https://cloud.google.com/dotnet/
Windows and .NET support on Google Cloud Platform. 

We will build a simple ASP.NET app, deploy to Google Compute Engine and take a look at some of the tools and APIs available to .NET developers on Google Cloud Platform.

https://cloud.google.com/sdk/docs/quickstart-windows
Google Cloud SDK for Windows (gcloud)

Installed with Cloud SDK for Windows is
https://googlecloudplatform.github.io/google-cloud-powershell
cmdlets for accessing and manipulating GCP resources

https://googlecloudplatform.github.io/google-cloud-dotnet/
Google Cloud CLient Libraries for .NET (new)
On NuGet for BigQuery, Datastore, Pub/Sub, Storage, Logging.

https://developers.google.com/api-client/dotnet/
Google API Client Libraries for .NET
https://github.com/GoogleCloudPlatform/dotnet-docs-samples

https://cloud.google.com/tools/visual-studio/docs/
available on Visual Studio Gallery.
Google Cloud Explorer accesses Compute Engine, Cloud Storage, Cloud SQL




## Learning resources

https://codelabs.developers.google.com/

<a target="_blank" href="https://codelabs.developers.google.com/codelabs/cloud-create-a-nodejs-vm/index.html?index=..%2F..%2Findex#0">Running Node.js on a Virtual Machine</a>


<a target="_blank" href="https://codelabs.developers.google.com/codelabs/gcp-aws-scaling-and-balancing/index.html?index=..%2F..%2Findex#0">
Scale and Load Balance Instances and Apps</a>

0. Get a GCP account
0. A project with billing enabled and the default network configured
0. An admin account with at least project owner role.

Create an instance template with a web app on it

Create a managed instance group that uses the template to scale

Create an HTTP load balancer that scales instances based on traffic and distributes load across availability zones

Define a firewall rule for HTTP traffic.

Test scaling and balancing under load.


## Classes

http://www.roitraining.com/google-cloud-platform-public-schedule/
in the US and UK
$599 per day

Lynn Langit created several video courses early in 2013/14 when Google Fiber was only available in Kansas City:

   * <a target="_blank" href="https://app.pluralsight.com/library/courses/google-cloud-intro/table-of-contents">
   Introduction to Google Cloud</a> [52min]
   for Developers

   * <a target="_blank" href="https://app.pluralsight.com/library/courses/google-compute-engine/table-of-contents">
   Introduction to Google Compute Engine</a>

https://deis.com/blog/2016/first-kubernetes-cluster-gke/

https://hub.docker.com/r/lucasamorim/gcloud/

https://github.com/campoy/go-web-workshop

http://www.anengineersdiary.com/2017/04/google-cloud-platform-tutorial-series_71.html

## More on cloud #

This is one of a series on cloud computing:

{% include cloud_links.html %}


