---
layout: post
title: "Selenium NeoLoad"
excerpt: "Load test sooner by updating NeoLoad scripts from Selenium"
tags: [Mac, Perftest]
shorturl: "https://goo.gl/"
image:
# pic silver robot white skin handshake 1900x500
  feature: https://cloud.githubusercontent.com/assets/300046/14622149/306629f0-0585-11e6-961a-dc8f60dadbf6.jpg
  credit: 
  creditlink: 
comments: true
---
<i>{{ page.excerpt }}</i>

{% include _toc.html %}

This article provides you a <strong>hands-on</strong> way to 
install and use Selenium and NeoLoad together in order
to include performance testing during software development.

This makes for easier/faster way to software development 
such that load testing is performed alongside software development and then 
included as part of System Demos at the end of each Agile sprint.

The sections of this tutorial:
   1. Get an instance of all the components in <a href="#UseDockerImage">Docker</a> or install on your own machine.
   2. Get the sample code from GitHub and see how it works.
   3. Leverage the samples to create your own.
   <br /><br />

## Why this software?

Selenium was created for functional testing.
Selenium controls (automates) the keyboard and mouse, emulating human end-users.
Selenium creates automation by emulating signals from keyboards and mice.

This technology makes use of Selenium to control the keyboard and mouse <strong>while</strong> NeoLoad listens to the network traffic
and updates its "user paths" (automation scripts) to emulate that network traffic.

After some editing, Neoload scripts are run on load generators that take the place of many real clients in order to
impose a <strong>simulated load</strong> on web servers and the infrastructure around it
(database, Web server, network components, etc.).
During "load test" runs, user response times and other statistics are captured by additional monitoring software.

All this is not yet the fully automatic vision where 
tests are created with the application code,
but it does foster additional speed and agility we haven't had before now.


## Workflow 

Here is how to do it, step-by-step.

0. <a href="#Install">Install</a> the various components on your machine or <a href="#UseDockerImage">use a Docker container</a>.
0. <a href="#Plan">Plan the sequence</a> of user actions and their transaction names under each "run type".
0. <a href="#BeginFrom">Get from GitHub</a> 
0. Create or reuse a <a href="#CreateNeoLoad">NeoLoad starter script</a> with an object recognition framework and data variation logic.
0. <a href="#ConfigNeoLoad">Configure NeoLoad</a> to be re-generated by Selenium.
0. <a href="#Jenkins">Run from a Jenkins job</a>.

   The above can be done once before a sprint, leveraging assets from other projects.

   As UI elements are created incrementally during a Sprint:

0. <strong>Update</strong> the Selenium script of new actions and transactions for NeoLoad.
0. <strong>Verify</strong> the Selenium script runs well (is functional).
0. <strong>Edit the Selenium script</strong> to add code to NeoLoad transactions.
0. <strong>Update</strong> the existing NeoLoad script by running the Selenium script. 
0. <strong>Edit the NeoLoad script</strong> to add correlations and verifications of <strong>new</strong> objects.
 
   Documentation for working in Java or C##:


<hr />

<a name="UseDockerImage"></a>

## User Docker image

The easiet way with work with this is to use Docker to download a single image which contains all the
<a href="#Installers">installers</a> already run.

In a Terminal window:

1. If you have Docker installed on your machine (and it has enough memory, CPU power, disk space),
   bring up an image that contins the image

   <tt><strong>docker pull ???/??? 
   </strong></tt>

2. Navigate to the folder that contains the demo code. In our case:

   <tt><strong>cd /gits/wilsonmar/Java-Selenium-NeoLoad 
   </strong></tt>

3. Pull down the latest version of the demo code, which may have been updated since the Docker image was put together:
   
   <tt><strong>git pull
   </strong></tt>

   TODO: Instead, use a shell script to do the above, and more.

4. <a href="#MavenInstall">Run Maven install</a>.


<a name="Install"></a>

## Install locally

I'm working now to have a similar script using PowerShell.

But if you have a Mac, you can try my single line installer to get these directly on your own machine:

1. Git client (to pull from GitHub)
0. <a href="#SampleApp">A Sample app to test</a> (Ushahidi, JPetStore, JPetClinic, etc.)
0. [Java Development Kit](/java-on-apple-mac-osx/)
0. [Maven](/maven-on-macos/) to build Java after processing the pom.xml file of dependencies

0. SikuliX which consists of:
   0. Selenium Web Driver
   0. Chrome with ChromeDriver
   0. Firefox browser
   0. GeckoDriver for Firefox
   0. Eclipse or IntelliJ IDE (optionally)
   0. OpenCV to recognize images
   0. Tesseract to recognize text

0. [NeoLoad 6.0 Install](/Neoload/)
0. <a href="#NLWebDriver">NeoLoad NLWebDriver</a> (added manually or via Maven)
0. <a href="#Monitoring">NeoLoad Monitoring</a>

All these are free open source software (FOSS), except NeoLoad which provides a free license for up to 50 simultaneous virtual users.

<hr />

<a name="BeginFrom"></a>

### Get from GitHub 

0. Change to a folder where you can get a sample repo on your local hard drive.

   <tt><strong>cd ~/gits/wilsonmar
   </strong></tt>

   We use `gits/wilsonmar`, but you would substitute "wilsonmar" with your own account name if you forked it.

0. Get the repo onto your local hard drive 
   (using this command which wraps into two lines):

   <tt><strong>
   git clone https://github.com/wilsonmar/Java-Selenium-NeoLoad  \-\-depth=1
   </strong></tt>

   `--depth=1` specifies the depth of history downloaded, with
   1 if you only want the latest version and no back versions.
   This saves some disk space.

0. Dive into the folder created by git clone:

   <tt><strong>cd Java-Selenium-NeoLoad
   </strong></tt>

   The folder contains a pom.xml file for processing by Maven.

   <a href="MavenInstall"></a>

   ### Maven clean install

0. Use a text editor to view the <strong>pom.xml</strong> file.

   The first part of the file:

   <pre>
<repositories>
  <repository>
      <id>neotys-public-releases</id>
      <url>http://maven.neotys.com/content/repositories/releases/</url>
      <releases><enabled>true</enabled></releases>
      <snapshots><enabled>false</enabled></snapshots>
  </repository>
</repositories>
   </pre>

   <a target="_blank" href="https://www.neotys.com/documents/doc/neoload/latest/en/html/#8275.htm">NeoLoad's documentation</a> states that
   NeoLoad integration has been tested on Selenium versions 2.53.0 and 3.0.1.

   NOTE: The version of the Selenium Proxy for Maven is 2.0.6.

   ```
<dependencies>
  <dependency>
    <groupId>com.neotys.selenium</groupId>
    <artifactId>neotys-selenium-proxy</artifactId>
    <version>2.0.6</version>
  </dependency>
  <dependency>
    <groupId>org.seleniumhq.selenium</groupId>
    <artifactId>selenium-java</artifactId>
    <version>2.0.6</version>
  </dependency>
</dependencies>
   ```

   A project is not developed using Maven, it is necessary to add
   the Selenium proxy JAR with dependencies available for download on the Neotys Labs page.

0. Have Maven download dependencies specified in the app's <strong>pom.xml</strong> file:

   <tt><strong>mvn clean install
   </strong></tt>

   The response:

   ???

   <a nam="#NLWebDriver"></a> 

   ### NeoLoad NLWebDriver

   (added manually or via Maven)

   The wrapper NLWebDriver provided by Neotys 
   enables Selenium scripts into NeoLoad User Paths.

   It can be used without any interaction with NeoLoad.
   Therefore it doesn't impact existing functional tests.


<a name="SampleApp"></a>

## Sample Code on Sample Apps

There are several sample apps.

Setting the server up is beyond the scope of this article.


<a name="Ushahidi"></a>

### Ushahidi sample web app

0. Click the URL below:

   <a target="_blank" href="http://ushahidi.demo.neotys.com/">
   <strong>http://ushahidi.demo.neotys.com</strong></a>

   This URL is within code examples within Neotys on-line documentation at:<br />
   <a target="_blank" href="https://www.neotys.com/documents/doc/neoload/latest/en/html/#8266.htm">
   https://www.neotys.com/documents/doc/neoload/latest/en/html/#8266.htm</a>

   <a name="Landing"></a>

   #### Landing

   <a target="_blank" href="https://user-images.githubusercontent.com/300046/28995095-56d12dc2-79ad-11e7-9719-1dba0f963185.png">
   <img alt="neoload-ushahidi-974x722-517k.png" href="https://user-images.githubusercontent.com/300046/28995095-56d12dc2-79ad-11e7-9719-1dba0f963185.png"></a>

   The Swahili word for "testimony" or "witness" is Ushahidi, and thus the name of the 
   <a target="_blank" href="https://www.ushahidi.com/"> 
   Ushahidi platform</a> used to build the app shown.

   Dots on the map shown shows the location of each observation reported around the world.

   <a target="_blank" href="https://en.wikipedia.org/wiki/Ushahidi#Products">
   According to Wikipedia</a>: this "crowdsourcing" app,
   the Ushahidi platform, was first released in 2009 <a target="_blank" href="https://github.com/ushahidi/platform">
   as open source on GitHub</a>. The current implementation is not complete:

   * Do not Click "Provide Feedback" at the bottom of the screen.
   A 404 page appears.

   * "Get Alerts" is not clicked within scripts because the response is "This module is not available".

   * There are no "Official & mainstream news" to view.

   * How to reset the data is unknown.


0. Reduce the width of the browser and note that the app is NOT "responsive" to different widths.

   #### NewAccount

0. Click the "Login" link at the top of the page.

0. Click "Create an Account".

   http://ushahidi.demo.neotys.com/login/?newaccount

0. Fill the information and click "Sign Up".

   #### ForgetPassword

0. Click the "Login" link at the too of the page.

0. Click "Forget Password".


   <a name="Login"></a>

   #### Login

0. Click the "Login" link at the too of the page.

   ![neoload-ushahidi-login-167x215-5k](https://user-images.githubusercontent.com/300046/28995262-cd6c8922-79b2-11e7-9aa4-61419b860ed7.png)

   Clicking Login within this app does not involve additional communication with the server.

   #### List

0. Click the "REPORTS" menu item.

   NOTE: Categories of observations currently are Cyclone, Avalanche, Wildfire.

   QUESTION: How much quicker would response time be if less observations are shown in the report?

   #### NewItem

0. Click "How to Report" on the upper-right corner of the map for the different
   mechanisms of reporting.
   http://ushahidi.demo.neotys.com/reports/submit/
   
   ![neoload-ushahidi-howtoreport-195x81-19k](https://user-images.githubusercontent.com/300046/28995256-98ab61ae-79b2-11e7-947f-aa4d23f30449.png)

0. Click "By filing this form on our website".

   <a target="_blank" href="https://user-images.githubusercontent.com/300046/28995521-46c9711c-79b9-11e7-8f7e-16567a567ee3.png">
   <img alt="neoload-ushahidi-newitem-918x801-297k.png" href="https://user-images.githubusercontent.com/300046/28995521-46c9711c-79b9-11e7-8f7e-16567a567ee3.png">

   QUESTION: How many files are downloaded initially? What is the size of each?

0. The form can also be reached by clicking the "SUBMIT A REPORT" menu item.

   QUESTION: How many files are downloaded on the second iteration? (Is the cache populated)

0. The form can also be reached by clicking the "SUBMIT A REPORT" orange button at the upper right corner.

   #### Search

0. Type in "Wildfire" next to the SEARCH button, then click the button.

   <a name="Plan"></a>

   ### Plan of Transactions by Run Type

   Functional of the app arranged by typical load testing run types:

   1. "Landing" (map display)
   0. "Menus"
   0. "NewAccount" - Create an account
   0. "LogInOut" - 
   0. "ForgotPassword" - to stress the email interface
   0. "NewItem" - "Submit a New Report" in the app at http://ushahidi.demo.neotys.com/reports/submit/
   0. "List" - 
   <br /><br />
   

<a name="CreateNeoLoad"></a>

## NeoLoad Starter script

In the GitHub repository is the NeoLoad starter script with an object recognition framework and data variation logic:

0. Invoke NeoLoadGUI version 6.
0. Within NeoLoadGUI open the sample User Path:

   <tt><strong>Ushahidi1.???
   </strong></tt>

   PROTIP: The User Path name begins with the application name with a
   number designating the app's release.

   ### Run Configuration

0. Go to Run Configuration

   [image here]

   `-Dnl.selenium.proxy.mode=Design` 
   is one of three modes to use the NeoLoad wrapper:

   * "NoApi" - This is the default mode. In this mode, there is no interaction with NeoLoad.
   * "Design" - a User Path is automatically created or updated through the Design API.
   * "EndUserExperience" - Selenium time measurements are sent to NeoLoad through the Data Exchange API.

   To set the mode, use the `nl.selenium.proxy.mode` property
   as a VM option or a program argument. Examples: 


<a name="UpdateSelenium"></a>

## Update Selenium

   As UI elements are created incrementally during a Sprint:

   
   ### JUnit IoC coding

   In the sample code are these annotations for the Java compiler to see:

   * `@Rule`
   * `@Before`
   * `@Test`
   * `@After`
   <br /><br />

   It's kinda like a "magic spell" which applies additional generic code
   around the line under the annotation. That spell can be used on 
   various lines, so annotations minimize coding.

   To see the basic structure of code behind an annotation, see<br />
   <a target="_blank" href="https://github.com/ajitsing/JavaCustomAnnotations">
   https://github.com/ajitsing/JavaCustomAnnotations</a>
   which provides a simple example to create a <a target="_blank" href="http://www.singhajit.com/java-custom-annotations/">
   custom annotation</a>. Basically, it uses Java Introspection features.

   The additional code added are defined within classes 
   imported at the top of the code.

   ```
import org.junit.Rule;
import org.junit.rules.TestName;
import org.junit.Before;
import org.junit.After;
   ```

   Annotations here are introduced with version 4 of JUnit.<br />
   <a target="_blank" href="https://github.com/junit-team/junit4/wiki/Rules">
   https://github.com/junit-team/junit4/wiki/Rules</a><br />
   explains that the <strong>@TestName Rule</strong> makes the current test name available inside test methods. The page begins by saying
   "Rules allow very flexible addition or redefinition of the behavior of each test method in a test class. Testers can reuse or extend one of the provided Rules below, or write their own."

   JUnit rules can intercept then:
   * access information about a test before it is run, such as
   <a target="_blank" href="http://www.singhajit.com/junit-rules/">
   setup and teardown a temporary database</a>.
   * modify a test before running it.
   * modify test results after a run.
   <br /><br />

   This is called "Inversion of Control" introduced in version 4 of JUnit.
   Junit Rules work on the principle of AOP (aspect oriented programming). 

   JUnit wraps your test method in a Statement object so statement.Execute() runs your test. Then instead of calling statement.Execute() directly to run your test, JUnit passes the Statement to a TestRule with the @Rule annotation. The TestRule's "apply" function returns a new Statement given the Statement with your test. The new Statement's Execute() method can call the test Statement's execute method (or not, or call it multiple times), and do whatever it wants before and after. Now JUnit has a new Statement that does more than just run the test, and it can again pass that to any more rules before finally calling Execute.
   * https://stackoverflow.com/questions/13489388/how-does-junit-rule-work



   Blogs about this:

   * http://www.singhajit.com/junit-rules/
   * http://cwd.dhemery.com/2011/01/what-junit-rules-are-good-for/
   * 
   * http://www.codeaffine.com/2012/09/24/junit-rules/
   * http://www.cubearticle.com/articles/framework/junit/junit-rule
   * http://cwd.dhemery.com/2010/12/junit-rules/

   ### Framework coding

   Instead of the test directly trying to interact with HTML elements
   and the DOM, the test uses the page class.
   Page Pattern 

   ![selenium-page-pattern-736x40-59k](https://user-images.githubusercontent.com/300046/29000078-bf19117a-7a2e-11e7-9907-842e49a8c0a5.png)


## Add new actions and transactions for NeoLoad.



   Using <strong>wrapper code</strong> allows quick and easy integration with existing Selenium test cases with minimal changes to existing code. Page load times and any error messages are sent to NeoLoad as external data.

   Replace the appropriate line of code to create the driver and use the NeoLoad driver instead:

   <pre>
import static com.neotys.selenium.proxies.NLWebDriverFactory.addProxyCapabilitiesIfNecessary;
import org.openqa.selenium.remote.DesiredCapabilities;
import com.neotys.selenium.proxies.NLWebDriver;
import com.neotys.selenium.proxies.NLWebDriverFactory;
   </pre>





   ### Where's the Main class?

   Regular Java programs have a Main class the Java compiler uses as
   the "entry point" to begin execution.

   `public static void main(String[] args)`

   This code accepts arguments given to execute the program.

<hr />

<a name="Monitoring"></a>

## Monitoring

User Experience Measurements

Regarding user experience measurements, the navigation library is available in the browsers listed here.

Measurement of the time elapsed on the end-user side is enabled by the 
<a target="_blank" href="https://www.w3.org/TR/navigation-timing/">
W3C Navigation Timing library at https://www.w3.org/TR/navigation-timing</a>
which on July 2017 is 
<a target="_blank" href="http://caniuse.com/#feat=nav-timing">
supported by leading modern internet browsers.


## Methods of the Selenium wrapper

The Neotys Selenium wrapper is compatible in all JUnit Selenium test scripts.

To specify the scenarios you want to update,
launch tests with Maven without specifying particular options or 
use the Design option and several dedicated methods on top of the Selenium driver 

   | Method | Description | Example |

* NLWebDriver(Selenium webdriver,Name of the NeoLoad User Path, path to the NL project);

* NLWebDriver is the constructor of the NeoLoad webdriver.
   This constructor allows you to specify the project that is to be updated with the new/updated User Path.

   ```
final FirefoxDriver webDriver = new FirefoxDriver(addProxyCapabilitiesIfNecessary(new DesiredCapabilities()));
// projectPath used to open NeoLoad project, null to use the currently opened Project.
final String projectPath = "C:\\Users\\apaul\\projects\\Sample_Project.nlp";
NLWebDriver driver = NLWebDriverFactory.newNLWebDriver(webDriver, "SeleniumUserPath", projectPath);
NLWebDriver(Selenium webdriver,Name of the NeoLoad User Path);
Project path is optional.
If the project is not specified, the wrapper will use the currently opened project.
final FirefoxDriver webDriver = new FirefoxDriver(addProxyCapabilitiesIfNecessary(new DesiredCapabilities()));
&nbsp;   
NLWebDriver driver = NLWebDriverFactory.newNLWebDriver(webDriver, "SeleniumUserPath");
StartTransaction(Name of the current transaction);
This method sends all the Selenium HTTP/HTTPS traffic into a specific NeoLoad container.
This methods needs to be used before the Selenium actions related to a business transaction.
public void testGetAlerts() {
driver.startTransaction("home2");
driver.get("http://ushahidi.demo.neotys.com/");
driver.startTransaction("alerts");
driver.findElement(By.partialLinkText("GET ALERTS")).click();
}
   ```

### Start Transactions

Transactions are defined to begin and stop specific time counters.

In this example, transactions can be added with the `startTransaction` method 
when creating or updating User Paths.

   ```
driver.startTransaction("home");
driver.get("http://ushahidi.demo.neotys.com/");
   ```

   Whenever the mode is not set to "Design", calls to startTransaction are ignored.


### UnitTest 1 Sample

The Selenium driver is started once and stopped at the end of the whole test. 

Only one User Path is created or updated.

   ```
package com.selenium.test;
import static com.neotys.selenium.proxies.NLWebDriverFactory.addProxyCapabilitiesIfNecessary;
import java.io.File;
import org.junit.AfterClass;
import org.junit.BeforeClass;
import org.junit.Test;
import org.openqa.selenium.By;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.remote.DesiredCapabilities;
import com.neotys.selenium.proxies.NLWebDriver;
import com.neotys.selenium.proxies.NLWebDriverFactory;
public class UnitTest {
  private static final String CHROME_DRIVER_PATH = "C:\\Selenium\\chromedriver.exe";
  static {
    final File file = new File(CHROME_DRIVER_PATH);
    System.setProperty("webdriver.chrome.driver", file.getAbsolutePath());
  }
  static NLWebDriver driver;

  @BeforeClass
  public static void before() {
    final ChromeDriver webDriver = new ChromeDriver(addProxyCapabilitiesIfNecessary(new DesiredCapabilities()));
    &nbsp;
    // projectPath used to open NeoLoad project, null to use currently opened Project.
    final String projectPath = "C:\\Users\\anouvel\\Documents\\NeoLoad Projects\\v5.3\\Sample_Project\\Sample_Project.nlp";
    &nbsp;
    driver = NLWebDriverFactory.newNLWebDriver(webDriver, "SeleniumUserPath", projectPath);
  }

  @Test
  public void testSubmit() {
    driver.startTransaction("home1");
    driver.get("http://ushahidi.demo.neotys.com/");
    &nbsp;
    driver.startTransaction("reports");
    driver.findElement(By.id("mainmenu")).findElements(By.tagName("a")).get(1).click();
    &nbsp;
    driver.startTransaction("submit");
    driver.findElement(By.partialLinkText("SUBMIT")).click();
  }
  
  @Test
  public void testGetAlerts() {
    driver.startTransaction("home2");
    driver.get("http://ushahidi.demo.neotys.com/");
    &nbsp;
    driver.startTransaction("alerts");
    driver.findElement(By.partialLinkText("GET ALERTS")).click();
  }
  
  @AfterClass
  public static void after() {
    if (driver != null) {
      driver.quit();
    }
  }
}
   ```

### UnitTest2 Example

The Selenium driver is started before each test and stopped at the end of each test. 
One User Path is created or updated per test.

   ```
package com.selenium.test;
import static com.neotys.selenium.proxies.NLWebDriverFactory.addProxyCapabilitiesIfNecessary;
import java.io.File;
import org.junit.After;
import org.junit.Before;
import org.junit.Rule;
import org.junit.Test;
import org.junit.rules.TestName;
import org.openqa.selenium.By;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.remote.DesiredCapabilities;
import com.neotys.selenium.proxies.NLWebDriver;
import com.neotys.selenium.proxies.NLWebDriverFactory;

public class UnitTest2 {
  private static final String CHROME_DRIVER_PATH = "C:\\Selenium\\chromedriver.exe";
    
  static {
    final File file = new File(CHROME_DRIVER_PATH);
    System.setProperty("webdriver.chrome.driver", file.getAbsolutePath());
  }
    
  @Rule // JUnit annotation
  public TestName testName = new TestName();
    
  NLWebDriver driver;
  
  @Before
  public void beforeTest() {
    final ChromeDriver webDriver = new ChromeDriver(addProxyCapabilitiesIfNecessary(new DesiredCapabilities()));
    final String projectPath = "C:\\Users\\anouvel\\Documents\\NeoLoad Projects\\v5.3\\Sample_Project\\Sample_Project.nlp";
    driver = NLWebDriverFactory.newNLWebDriver(webDriver, testName.getMethodName(), projectPath);
  }
  
  @Test
  public void testSubmit() {
    driver.startTransaction("home");
    driver.get("http://ushahidi.demo.neotys.com/");
  
    driver.startTransaction("reports");
    driver.findElement(By.id("mainmenu")).findElements(By.tagName("a")).get(1).click();
  
    driver.startTransaction("submit");
    driver.findElement(By.partialLinkText("SUBMIT")).click();
  }
  
  @Test
  public void testGetAlerts() {
    driver.startTransaction("home");
    driver.get("http://ushahidi.demo.neotys.com/");
  
    driver.startTransaction("alerts");
    driver.findElement(By.partialLinkText("GET ALERTS")).click();
  }
  
  @Test
  public void testSubmitIncident(){
    driver.startTransaction("home");
    driver.get("http://ushahidi.demo.neotys.com/");
    
    driver.startTransaction("submit-incident");
    driver.findElement(By.className("submit-incident")).click();
    driver.findElement(By.id("incident_title")).sendKeys("Title");
    driver.findElement(By.id("incident_description")).sendKeys("Description");
    driver.findElement(By.id("location_name")).sendKeys("Gémenos, France");
    driver.findElement(By.cssSelector("input[type='checkbox'][value='2']")).click();
    driver.findElement(By.className("btn_submit")).click();
  }
  
  @After
  public void afterTest() {
    if (driver != null) {
      driver.quit();
    }
  }
}
   ```

<a name="InvokeByMaven"></a>

## Invoke by Maven

Use the Selenium driver as a Maven task.

### Maven Surefire plugin

To launch only a subset of unit tests, add and use the Maven surefire plugin.

1. First, include this in your pom.xml :

   ```
<plugin>
 <groupId>org.apache.maven.plugins</groupId>
 <artifactId>maven-surefire-plugin</artifactId>
   <version>2.19.1</version>
    <dependencies>
     <dependency>
        <groupId>org.apache.maven.surefire</groupId>
        <artifactId>surefire-junit47</artifactId>
   <version>2.19.1</version>
     </dependency>
    </dependencies>
</plugin>
   ```

   

0. Launch tests using a command. For example, the asterisk in this launches only test classes that end with "PerformanceTest":

   ```
mvn -Dnl.selenium.proxy.mode=Design -Dnl.design.api.url=http://[host]:7400/Design/v1/Service.svc/ -Dtest=*PerformanceTest clean test
   ```

   The tests of course must have been defined within the test repository of your Maven project.


### Methods of the Selenium wrapper

Method
Description
Example

NLWebDriver(Selenium webdriver,Name of the NeoLoad User Path, path to the NL project);

NLWebDriver is the constructor of the NeoLoad webdriver.

This constructor allows you to specify the project that is to be updated with the new/updated User Path.
final FirefoxDriver webDriver = new FirefoxDriver(addProxyCapabilitiesIfNecessary(new DesiredCapabilities()));

   ```
// projectPath used to open NeoLoad project, null to use the currently opened Project.
final String projectPath = "C:\\Users\\apaul\\projects\\Sample_Project.nlp";
NLWebDriver driver = NLWebDriverFactory.newNLWebDriver(webDriver, "SeleniumUserPath", projectPath);
NLWebDriver(Selenium webdriver,Name of the NeoLoad User Path);
Project path is optional.
If the project is not specified, the wrapper will use the currently opened project.
final FirefoxDriver webDriver = new FirefoxDriver(addProxyCapabilitiesIfNecessary(new DesiredCapabilities()));
 
NLWebDriver driver = NLWebDriverFactory.newNLWebDriver(webDriver, "SeleniumUserPath");
   ```

#### setCustomName

This method sets a custom name of the next Entry that will be sent to the Data Exchange server.

   ```
driver.SetCustomName("custom entry name");
   ```

### Advanced usage

The Java proxy sets a custom name of the next Entry that will be sent to the Data Exchange server.

Additionally there is a method to retrieve the regular expression being used to create the path when the 
`nl.path.naming.policy argument` is set to URL.

The example below illustrates these advanced uses:

   ```
NLWebDriver driver = WebDriverProxy.newInstance(new FirefoxDriver());
driver.setCustomName("custom entry name");
System.out.println("Escaped regular expression: " + driver.getRegexToCleanURLs());
   ```

#### Create manual timers

If the tested application is not compatible with the navigation timing library, 
you can still create your own timers manually by using the DataExchange client library.

In order to send external data to NeoLoad without Java, 
you can create custom timers manually, either from scratch or with the help of our utility TimerBuilder.

To create manual timers, you need first to create the Data Exchange API Client as described below.

The NeoLoad Data Exchange API Client provides the utility TimerBuilder in order to time a transaction (a set of business actions).
Below is an example of Java code to add a timer.

   ```
import com.neotys.rest.dataexchange.model.TimerBuilder;

// Start timer
final TimerBuilder timer = TimerBuilder.start("scriptName", "timerName");

// Do some transactions, for example:
vpba16.avw_backboneCellarAndro.avw_.mo_cHATEAU_LE_DOYENNE.click();

// Stop timer
dataExchangeAPIClient.addEntry(timer.stop());
   ```

To enhance the timer’s information with specific data, for example a URL, a status, etc. 

   ```
import com.neotys.rest.dataexchange.model.Status.State;
import com.neotys.rest.dataexchange.model.TimerBuilder;
import com.neotys.rest.dataexchange.model.Status;
import com.neotys.rest.dataexchange.model.Status.State;
import com.neotys.rest.dataexchange.model.StatusBuilder;

// Start timer
final TimerBuilder timer = TimerBuilder.start("scriptName", "timerName");

// Do some transactions, for example:
vpba16.avw_backboneCellarAndro.avw_.mo_cHATEAU_LE_DOYENNE.click();

// Specify URL
timer.url("myURL");

// Specify Status
final Status status = (new StatusBuilder()).code("code").message("message").state(State.PASS).build();

timer.status(status);

// Stop timer
dataExchangeAPIClient.addEntry(timer.stop());
   ```

The transactions’ timers are then accessible in the Runtime and Results views of NeoLoad:


### Timers-Results

Metrics retrieved by the Selenium wrapper

The Selenium wrapper automatically retrieves navigation timers and sends them to the NeoLoad Data Exchange API.

All metrics sent to NeoLoad are specified in milliseconds.

These metrics are available during runtime and once the test is complete in the Runtime and Results sections:

   * Time to First Byte
   * DOM content loaded
   * On Load
   * Document complete


### Configuration options

All options except the driver instance are passed via command line arguments.

Tip: Arguments may require quotation marks to function properly. For example: 

   "-Dnl.script.name=my_name" instead of -Dnl.script.name=my_name.

Argument
Description
new FirefoxDriver()
(Required) Any driver that returns a WebDriver interface.
 
   ``` 
NLWebDriver driver = WebDriverProxy.newInstance(new FirefoxDriver());
   ```
or

   ```
NLSelenium selenium = WebDriverBackedSeleniumProxy.newInstance(new WebDriverBackedSelenium(new FirefoxDriver(), baseUrl));
nl.api.key
   ```

(Optional) The API key to send to NeoLoad.
Default: <none>
nl.data.exchange.url
(Required) The URL to the data exchange server on the NeoLoad Controller.
Example: -Dnl.data.exchange.url=http://localhost:7400/DataExchange/v1/Service.svc/
Default: http://localhost:7400/DataExchange/v1/Service.svc/
nl.debug
(Optional) Prints various information from the Selenium proxy wrapper to standard out.
Default: false
Example:

   ```
-Dnl.debug=true
nl.design.api.url
   ```

(Required) The URL to the Design API server on the NeoLoad Controller.
Example: 

   ```
-Dnl.design.api.url=http://localhost:7400/Design/v1/Service.svc/
Default: http://localhost:7400/Design/v1/Service.svc/
nl.hardware
   ```

(Optional) Specify this setting for the external data Entry.
Default: <none>

   ```
nl.instance.id
   ```

(Optional) The instanceID to use.
Default: <date/time stamp>

   ```
nl.location
   ```

(Optional) Specify this setting for the external data Entry.
Default: <none>
   ```
nl.os
   ```

(Optional) Specify this setting for the external data Entry.
Default: Windows, Linux, Mac OS, etc. (based on the operating system)
   ```
nl.path.naming.policy
   ```
(Optional) This is used to set the naming policy. The argument must be URL, Title, or Action.
URL: Use the last part of the URL as the Entry path.
Title: Use the page title as the Entry path.
Action: Use the last action as the Entry path. Actions can be link selections or clicks.
Default: URL
Example:
   ```
-Dnl.path.naming.policy=Title
nl.regex.to.clean.urls
   ```
(Optional) Used in conjunction with the URL PathNamingPolicy. This specifies the regular expression used to extract a path from a URL. When multiple groups are used, all matching text from each group is used in the path.
Default: (.*?)[#?;%].*
Example: -Dnl.regex.to.clean.urls=.*?\\\?(.*?)|(.*?)[#?;%].*|(.*)
Note that this example becomes .*?\?(.*?)|(.*?)[#?;%].*|(.*) after escaping
nl.script.name
(Optional) Specify this setting for the external data Entry.
Default outside of JUnit: SeleniumDelegate
Default in a JUnit test: SeleniumDelegate-&LT;test method name>
   ```
nl.selenium.proxy.enabled
   ```
(Deprecated) Enables or disables creating and sending entries.
Default: True
nl.software
(Optional) Specify this setting for the external data Entry.
Default: &LT;none>


### Export Selenium scripts

After customizing the Selenium test scripts, export the Java project to a runnable JAR file so that it can be launched by NeoLoad.

Tip: If you want a launch configuration that contains the test class to execute, create a TestSuite class by adapting the example below:

   ```
import org.junit.runner.JUnitCore;
import org.junit.runner.RunWith;
import org.junit.runners.Suite;
    
@RunWith(Suite.class)
    
@Suite.SuiteClasses({
   HomeTest.class,
   ReportTest.class
})
    
public class EndUserExperienceTestSuite {
  public static void main(String[] args) throws Exception {
         JUnitCore.main(EndUserExperienceTestSuite.class.getName());            
  }
}
   ```

If you are working in the Eclipse IDE, export the Selenium scripts, follow the steps below:

1. Right-click on your Eclipse project and select Export to a Runnable JAR file.

   ```
   nl-exportjarfileselenium
   ```

### Export Jar File Selenium

Enter a project name, specify the directory where to save the JAR file:

   ```
   nl-runnablejarspecselenium
   ```

in the /custom-resources folder of your NeoLoad project

   ```
   nl-runnablejarspecselenium
   ```

in the /extlib directory of your NeoLoad installation for multi-project usage, click Finish.

The file will be automatically sent to Load Generators when a test is run.


## Start Selenium scripts

"User Experience" scripts created in Selenium are started by NeoLoad's Java Test Script advanced action.

For more information about the Java Test Script advanced action, refer to the Java Test Script Launchers documentation.

The following configuration is required:

JRE is the path to the Java Runtime Environment executable on the Load Generator

   * Attribute arg1 must be: -jar
   * Attribute arg2 must contain the path of the JAR file that was exported, either its absolute path or the path relative to the custom-resources folder in the NeoLoad project: ${NL-CustomResources}/myjar.jar
   * Attribute arg3 must contain the mode -Dnl.selenium.proxy.mode=EndUserExperience
   * Attribute arg4 must contain the mode -Dnl.data.exchange.url=http://192.168.1.6:7400/DataExchange/v1/Service.svc/

nl-seleniumjavaproxyconfigoptions2.png

### Configure the NeoLoad scenario

To configure your User Experience scenario, follow the guidelines documented in the End User Experience Integration User Guide.


### See run results

The external data injected during execution is displayed in Results > Details.
For more information, see by external data.

https://www.neotys.com/documents/doc/neoload/latest/en/html/#1484.htm#o7602


### License setup

License module "Integration & Advanced Usage" is required to enable the End User Experience Integration.

   * https://www.neotys.com/documents/doc/neoload/latest/en/html/#8269.htm
 
0. Get to the "NeoLoad Selenium Proxy Driver" from the  
   https://www.neotys.com/support/neotys-labs/selenium-proxy-driver-for-end-user-experience

   <a target="_blank" href="https://www.neotys.com/support/neotys-labs">
   Neotys Labs page at https://www.neotys.com/support/neotys-labs</a>.
   
   The direct link for Java at time of writing is:
 
   <a target="_blank" href="https://www.neotys.com/support/neotys-labs/selenium-proxy-driver-for-end-user-experience">
   https://www.neotys.com/support/neotys-labs/selenium-proxy-driver-for-end-user-experience</a>

   https://www.neotys.com/support/neotys-labs/selenium-proxy-driver-c-automated-script-maintenance-end-user-experience

   The Selenium Proxy Driver allows you to use a Selenium script to create or update NeoLoad User Paths and/or measure the end user experience on one or a few browsers or mobile devices and to send these measurements to NeoLoad.

0. Click "Download: Jar" link to download file:

   neotys-selenium-proxy-2.0.6.jar

0. Click "Jar-with-dependencies" link to download file:

   neotys-selenium-proxy-with-dependencies-2.0.6
 
0. Optionally, click "Source" link to download file:

   neotys-selenium-proxy-2.0.6-sources
 
0. Optionally, click "Javadoc" link to download file:

   neotys-selenium-proxy-2.0.6-javadoc
 
0. In your Downloads folder, invoke the "Selenium Proxy Driver" from the 

   

0. Modify Selenium scripts to indicate the NeoLoad Selenium driver.

0. Modify Selenium scripts to add timers that will be converted into NeoLoad "transactions".
 
0. Set the mode appropriately for the Selenium execution:

   https://www.neotys.com/documents/doc/neoload/latest/en/html/#23462.htm
 

<a name="Jenkins"></a>

## Jenkins



## References

https://www.youtube.com/watch?v=x0RE2_MLCLQ
Continuous Performance Testing and Monitoring in Agile Development
by Neotys 


## Scraps - ignore

NOTE: The NeoLoad API for Selenium also enables capture of end-user experience measurements and 
equate them back into the NeoLoad results set.

This makes use the NeoLoad’s Java Launcher action.

NeoLoad can collect end-user experience and sends to 
NeoLoad the metrics calculated on the client (browser or mobile devices).
 
